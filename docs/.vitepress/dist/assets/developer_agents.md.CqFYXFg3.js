import{_ as i,o as t,c as o,ag as a}from"./chunks/framework.Q1EpFJIG.js";const h=JSON.parse('{"title":"Agent Rules and Guidelines","description":"","frontmatter":{},"headers":[],"relativePath":"developer/agents.md","filePath":"developer/agents.md"}'),n={name:"developer/agents.md"};function r(l,e,s,d,c,u){return t(),o("div",null,[...e[0]||(e[0]=[a('<h1 id="agent-rules-and-guidelines" tabindex="-1">Agent Rules and Guidelines <a class="header-anchor" href="#agent-rules-and-guidelines" aria-label="Permalink to &quot;Agent Rules and Guidelines&quot;">​</a></h1><h2 id="architecture-overview" tabindex="-1">Architecture Overview <a class="header-anchor" href="#architecture-overview" aria-label="Permalink to &quot;Architecture Overview&quot;">​</a></h2><p>This project is a REST API built with Node.js, utilizing the Hapi.js framework. It follows a modular architecture separating configuration, controllers, models, and schemas.</p><ul><li><strong>Framework</strong>: Hapi.js (v21+)</li><li><strong>Database</strong>: MySQL (accessed via Sequelize ORM v6)</li><li><strong>Authentication</strong>: <code>hapi-auth-jwt2</code> (JWT) and <code>@hapi/bell</code> (OAuth)</li><li><strong>Validation</strong>: <code>joi</code> (v17)</li><li><strong>Platform</strong>: Google App Engine (Standard Environment, Node.js 22 runtime)</li></ul><h3 id="project-structure" tabindex="-1">Project Structure <a class="header-anchor" href="#project-structure" aria-label="Permalink to &quot;Project Structure&quot;">​</a></h3><ul><li><code>server/config/</code>: Configuration files (routes, database configs, environments).</li><li><code>server/controllers/</code>: Business logic and route handlers. <strong>All logic must reside here.</strong></li><li><code>server/models/</code>: Sequelize models defining database schema.</li><li><code>server/schemas/</code>: Joi schemas for validation and SCIM structures.</li><li><code>server/index.js</code>: Server entry point, plugin registration, and lifecycle hooks.</li><li><code>migrations/</code>: Database schema migrations.</li></ul><h2 id="build-and-run-guidelines" tabindex="-1">Build and Run Guidelines <a class="header-anchor" href="#build-and-run-guidelines" aria-label="Permalink to &quot;Build and Run Guidelines&quot;">​</a></h2><h3 id="running-locally" tabindex="-1">Running Locally <a class="header-anchor" href="#running-locally" aria-label="Permalink to &quot;Running Locally&quot;">​</a></h3><ul><li><strong>Start</strong>: <code>npm start</code> (Runs <code>node ./server.js</code>)</li><li><strong>Debug</strong>: <code>npm run debug</code> (Runs with <code>nodemon</code> and inspector)</li><li><strong>Lint</strong>: <code>npm run lint</code> (ESLint on server/ and migrations/)</li></ul><h3 id="database-migrations" tabindex="-1">Database &amp; Migrations <a class="header-anchor" href="#database-migrations" aria-label="Permalink to &quot;Database &amp; Migrations&quot;">​</a></h3><ul><li><strong>ORM</strong>: Sequelize</li><li><strong>Migrations</strong>: Managed via <code>sequelize-cli</code> wrapped in <code>run.js</code>. <ul><li>Run: <code>npm run migrate:run</code></li><li>Undo: <code>npm run migrate:undo</code></li><li>Status: <code>npm run migrate:status</code></li><li>Create: <code>npm run migration:create --name &lt;name&gt;</code></li></ul></li></ul><h3 id="testing" tabindex="-1">Testing <a class="header-anchor" href="#testing" aria-label="Permalink to &quot;Testing&quot;">​</a></h3><ul><li><strong>Method</strong>: Postman Collections run via Newman.</li><li><strong>CI Integration</strong>: Validated in Google Cloud Build using <code>newman</code>.</li><li><strong>Test Maintenance</strong>: When adding, modifying, or removing API endpoints, you MUST update the corresponding tests in <code>test/runner.json</code> to reflect the changes. This includes: <ul><li>Adding tests for new endpoints</li><li>Updating tests when endpoint behavior changes</li><li>Removing or updating tests when endpoints are deprecated</li><li>Ensuring all endpoint parameters and response formats are validated</li></ul></li></ul><h2 id="architectural-rules" tabindex="-1">Architectural Rules <a class="header-anchor" href="#architectural-rules" aria-label="Permalink to &quot;Architectural Rules&quot;">​</a></h2><h3 id="route-handlers" tabindex="-1">Route Handlers <a class="header-anchor" href="#route-handlers" aria-label="Permalink to &quot;Route Handlers&quot;">​</a></h3><ul><li><strong>Do NOT</strong> place inline handlers in <code>server/config/routes.js</code>.</li><li>Always move handlers to the respective controller (component) file (e.g., <code>server/controllers/mcp.js</code>).</li><li>This ensures better maintainability, separation of concerns, and easier testing.</li><li>Use the <code>config</code> property in <code>routes.js</code> to reference the exported controller configuration/handler.</li></ul><h3 id="attribute-visibility" tabindex="-1">Attribute Visibility <a class="header-anchor" href="#attribute-visibility" aria-label="Permalink to &quot;Attribute Visibility&quot;">​</a></h3><ul><li><strong>Strict Attribute Sharing</strong>: Users should only be able to retrieve attributes that are shared with them in a group.</li><li><strong>NEVER</strong> add optional attributes like <code>division</code>, <code>department</code>, or <code>costCenter</code> to the <code>mandatoryAttributes</code> list in <code>server/schemas/user.js</code>.</li><li>If an attribute is missing in a response, verify that the attribute is correctly added to the <code>sharedAttributes</code> definition of the user&#39;s groups.</li></ul><h3 id="scim-2-0-compliance" tabindex="-1">SCIM 2.0 Compliance <a class="header-anchor" href="#scim-2-0-compliance" aria-label="Permalink to &quot;SCIM 2.0 Compliance&quot;">​</a></h3><ul><li><strong>Users and Groups Endpoints</strong>: The <code>/v2/Users</code> and <code>/v2/Groups</code> endpoints MUST remain fully compliant with the SCIM 2.0 specification (RFC 7643 and RFC 7644).</li><li><strong>Schema Requirements</strong>: <ul><li>All responses must include proper SCIM schemas in the <code>schemas</code> array</li><li>Core schemas: <code>urn:ietf:params:scim:schemas:core:2.0:User</code> and <code>urn:ietf:params:scim:schemas:core:2.0:Group</code></li><li>Extension schemas: <code>urn:ietf:params:scim:schemas:extension:fd:2.0:User</code> and <code>urn:ietf:params:scim:schemas:extension:fd:2.0:Group</code></li><li>List responses: <code>urn:ietf:params:scim:api:messages:2.0:ListResponse</code></li><li>Patch operations: <code>urn:ietf:params:scim:api:messages:2.0:PatchOp</code></li></ul></li><li><strong>Response Structure</strong>: Follow SCIM conventions for resource representation, pagination, filtering, and error handling.</li><li><strong>Extensions</strong>: Custom attributes must be properly namespaced under FD-specific extension schemas.</li><li><strong>Breaking Changes</strong>: Any modification to SCIM-compliant endpoints requires careful review to maintain backward compatibility with SCIM clients.</li></ul><h3 id="logging" tabindex="-1">Logging <a class="header-anchor" href="#logging" aria-label="Permalink to &quot;Logging&quot;">​</a></h3><ul><li>Do not use <code>console.log</code>. Use the <code>core.log</code> utility provided in <code>server/controllers/core.js</code>. <ul><li><code>core.log.info(message, data)</code></li><li>``core.log.error(message, error)`</li></ul></li></ul><h3 id="api-stability" tabindex="-1">API Stability <a class="header-anchor" href="#api-stability" aria-label="Permalink to &quot;API Stability&quot;">​</a></h3><ul><li><strong>NEVER</strong> implement breaking API changes without explicit user approval and migration plan.</li><li>A breaking change is any modification that could cause existing clients to fail, including: <ul><li>Removing or renaming endpoints</li><li>Removing or renaming required parameters</li><li>Changing response data structures in incompatible ways</li><li>Changing authentication or authorization requirements</li><li>Modifying error response formats</li></ul></li><li>When breaking changes are unavoidable: <ul><li>Document the breaking change clearly</li><li>Provide a migration path for existing clients</li><li>Consider versioning (e.g., <code>/v3/</code> endpoints) instead of modifying existing endpoints</li><li>Get explicit user approval before implementation</li></ul></li></ul><h3 id="code-style" tabindex="-1">Code Style <a class="header-anchor" href="#code-style" aria-label="Permalink to &quot;Code Style&quot;">​</a></h3><ul><li>Follow strict ESLint and Prettier rules.</li><li>Pre-commit hooks (<code>husky</code>) enforce linting and formatting.</li><li><strong>Imports</strong>: Always place <code>require</code> statements at the top of the file. Do not scatter them throughout the code.</li></ul><h3 id="database-standards" tabindex="-1">Database Standards <a class="header-anchor" href="#database-standards" aria-label="Permalink to &quot;Database Standards&quot;">​</a></h3><h4 id="naming-conventions-models-and-tables" tabindex="-1">Naming Conventions (Models and Tables) <a class="header-anchor" href="#naming-conventions-models-and-tables" aria-label="Permalink to &quot;Naming Conventions (Models and Tables)&quot;">​</a></h4><ul><li><strong>CamelCase</strong>: All new models and database tables must be named using <code>camelCase</code>. <ul><li>✅ <code>apiKeyMember</code></li><li>✅ <code>userProfile</code></li><li>❌ <code>api_key_member</code></li><li>❌ <code>user_profile</code></li></ul></li></ul><h4 id="timestamps" tabindex="-1">Timestamps <a class="header-anchor" href="#timestamps" aria-label="Permalink to &quot;Timestamps&quot;">​</a></h4><ul><li><strong>Column Names</strong>: Always use <code>created</code> and <code>lastModified</code> (NOT <code>createdAt</code> or <code>updatedAt</code>).</li><li><strong>Sequelize Behavior</strong>: <ul><li><strong>Models</strong>: Sequelize is globally configured to automatically map <code>createdAt</code> to <code>created</code> and <code>updatedAt</code> to <code>lastModified</code>. You do not need to define these in the model unless disabling them.</li><li><strong>Migrations</strong>: You <strong>MUST</strong> explicitly define <code>created</code> and <code>lastModified</code> columns in <code>createTable</code>. Sequelize does <strong>NOT</strong> add these automatically in migrations.</li></ul></li></ul><h2 id="agent-operational-rules" tabindex="-1">Agent Operational Rules <a class="header-anchor" href="#agent-operational-rules" aria-label="Permalink to &quot;Agent Operational Rules&quot;">​</a></h2><h3 id="mandatory-development-workflow" tabindex="-1">MANDATORY DEVELOPMENT WORKFLOW <a class="header-anchor" href="#mandatory-development-workflow" aria-label="Permalink to &quot;MANDATORY DEVELOPMENT WORKFLOW&quot;">​</a></h3><p>To ensure safety and provide the user with full control, all agents MUST adhere to this strict multi-turn workflow for any code modification:</p><ol><li><p><strong>STEP 1: Analysis &amp; Planning</strong>:</p><ul><li>Explore the codebase, read relevant files, and research the task.</li><li>Present a concise plan to the user and wait for approval if the task is complex.</li></ul></li><li><p><strong>STEP 2: Implementation &amp; Verification (The &quot;No-Commit&quot; Turn)</strong>:</p><ul><li>Apply file edits (<code>edit</code>, <code>write</code>).</li><li>Run all necessary verifications: unit tests, Postman tests (<code>newman</code>), linting (<code>npm run lint</code>), and <code>git diff</code>.</li><li><strong>CRITICAL STOP</strong>: You MUST end your response immediately after presenting the verification results. You are FORBIDDEN from running <code>git commit</code> or <code>git push</code> in this turn.</li></ul></li><li><p><strong>STEP 3: User Review</strong>:</p><ul><li>Summarize what was changed and show that tests passed.</li><li>Explicitly ask the user: &quot;Shall I commit these changes?&quot;</li></ul></li><li><p><strong>STEP 4: Commit &amp; Push</strong>:</p><ul><li>ONLY after the user provides an explicit &quot;Yes&quot; or &quot;Commit this&quot;, you may proceed to run <code>git add</code>, <code>git commit</code>, and <code>git push</code>.</li></ul></li></ol><h3 id="critical-git-safety-protocol" tabindex="-1">CRITICAL GIT SAFETY PROTOCOL <a class="header-anchor" href="#critical-git-safety-protocol" aria-label="Permalink to &quot;CRITICAL GIT SAFETY PROTOCOL&quot;">​</a></h3><ul><li><strong>NO AUTO-COMMITS</strong>: Never combine code edits and git commits in a single tool call sequence or response turn.</li><li><strong>Read-Only Default</strong>: You may run read-only git commands (<code>status</code>, <code>log</code>, <code>diff</code>) freely to understand the context.</li><li><strong>Explicit Approval</strong>: <code>git commit</code> and <code>git push</code> require a direct, specific request from the developer in the <em>current</em> prompt.</li><li><strong>Verification First</strong>: Always verify changes (run tests, check diffs, verify server status) in Step 2 before moving to Step 3.</li></ul>',37)])])}const m=i(n,[["render",r]]);export{h as __pageData,m as default};
