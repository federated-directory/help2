{
  "version": 3,
  "sources": ["../../../src/migrations/v-2.2.0/migration.ts"],
  "sourcesContent": ["import type { v_2_1_0 } from '@/migrations/v-2.1.0/types.generated'\n\nimport type { v_2_2_0 } from './types.generated'\n\n/** Migrate security scheme from v-2.1.0 to v-2.2.0 */\nconst migrateSecurityScheme = (\n  scheme: v_2_1_0.SecurityScheme,\n  auth: v_2_1_0.Collection['auth'][string],\n): v_2_2_0.SecurityScheme | null => {\n  // API Key\n  if (scheme.type === 'apiKey' && auth.type === 'apiKey') {\n    return {\n      ...scheme,\n      value: auth.value,\n    }\n  }\n\n  // HTTP\n  if (scheme.type === 'http' && auth.type === 'http') {\n    return {\n      ...scheme,\n      username: auth.username,\n      password: auth.password,\n      token: auth.token,\n    }\n  }\n\n  // OAuth2\n  if (scheme.type === 'oauth2') {\n    const { flow, ..._scheme } = scheme\n\n    // Implicit\n    if (flow.type === 'implicit' && auth.type === 'oauth-implicit') {\n      return {\n        ..._scheme,\n        flows: {\n          implicit: {\n            ...flow,\n            'scopes': flow.scopes as Record<string, string>,\n            'token': auth.token,\n            'x-scalar-client-id': _scheme['x-scalar-client-id'],\n          },\n        },\n      }\n    }\n\n    // Password\n    if (flow.type === 'password' && auth.type === 'oauth-password') {\n      return {\n        ..._scheme,\n        flows: {\n          password: {\n            ...flow,\n            'username': auth.username,\n            'password': auth.password,\n            'token': auth.token,\n            'clientSecret': auth.clientSecret,\n            'scopes': flow.scopes as Record<string, string>,\n            'x-scalar-client-id': _scheme['x-scalar-client-id'],\n          },\n        },\n      } satisfies v_2_2_0.SecurityScheme\n    }\n\n    // Client Credentials\n    if (flow.type === 'clientCredentials' && auth.type === 'oauth-clientCredentials') {\n      return {\n        ..._scheme,\n        flows: {\n          clientCredentials: {\n            ...flow,\n            'token': auth.token,\n            'clientSecret': auth.clientSecret,\n            'scopes': flow.scopes as Record<string, string>,\n            'x-scalar-client-id': _scheme['x-scalar-client-id'],\n          },\n        },\n      } satisfies v_2_2_0.SecurityScheme\n    }\n\n    // Authorization Code\n    if (flow.type === 'authorizationCode' && auth.type === 'oauth-authorizationCode') {\n      return {\n        ..._scheme,\n        flows: {\n          authorizationCode: {\n            ...flow,\n            'token': auth.token,\n            'clientSecret': auth.clientSecret,\n            'scopes': flow.scopes as Record<string, string>,\n            'x-scalar-client-id': _scheme['x-scalar-client-id'],\n          },\n        },\n      } satisfies v_2_2_0.SecurityScheme\n    }\n  }\n\n  return null\n}\n\n/** V-2.1.0 to V-2.2.0 migration */\nexport const migrate_v_2_2_0 = (data: v_2_1_0.DataRecord): v_2_2_0.DataRecord => {\n  console.info('Performing data migration v-2.1.0 to v-2.2.0')\n\n  const securitySchemes = Object.values(data.securitySchemes).reduce<v_2_2_0.DataRecord['securitySchemes']>(\n    (prev, s) => {\n      const collection = Object.values(data.collections).find((c) => c.securitySchemes.includes(s.uid))\n      const auth = collection?.auth?.[s.uid]\n      if (!auth) {\n        return prev\n      }\n\n      const newScheme = migrateSecurityScheme(s, auth)\n      if (newScheme) {\n        prev[s.uid] = newScheme\n      }\n\n      return prev\n    },\n    {},\n  )\n\n  // No changes to servers\n  const servers = data.servers as v_2_2_0.DataRecord['servers']\n\n  return {\n    ...data,\n    securitySchemes,\n    servers,\n  } satisfies v_2_2_0.DataRecord\n}\n"],
  "mappings": "AAKA,MAAM,wBAAwB,CAC5B,QACA,SACkC;AAElC,MAAI,OAAO,SAAS,YAAY,KAAK,SAAS,UAAU;AACtD,WAAO;AAAA,MACL,GAAG;AAAA,MACH,OAAO,KAAK;AAAA,IACd;AAAA,EACF;AAGA,MAAI,OAAO,SAAS,UAAU,KAAK,SAAS,QAAQ;AAClD,WAAO;AAAA,MACL,GAAG;AAAA,MACH,UAAU,KAAK;AAAA,MACf,UAAU,KAAK;AAAA,MACf,OAAO,KAAK;AAAA,IACd;AAAA,EACF;AAGA,MAAI,OAAO,SAAS,UAAU;AAC5B,UAAM,EAAE,MAAM,GAAG,QAAQ,IAAI;AAG7B,QAAI,KAAK,SAAS,cAAc,KAAK,SAAS,kBAAkB;AAC9D,aAAO;AAAA,QACL,GAAG;AAAA,QACH,OAAO;AAAA,UACL,UAAU;AAAA,YACR,GAAG;AAAA,YACH,UAAU,KAAK;AAAA,YACf,SAAS,KAAK;AAAA,YACd,sBAAsB,QAAQ,oBAAoB;AAAA,UACpD;AAAA,QACF;AAAA,MACF;AAAA,IACF;AAGA,QAAI,KAAK,SAAS,cAAc,KAAK,SAAS,kBAAkB;AAC9D,aAAO;AAAA,QACL,GAAG;AAAA,QACH,OAAO;AAAA,UACL,UAAU;AAAA,YACR,GAAG;AAAA,YACH,YAAY,KAAK;AAAA,YACjB,YAAY,KAAK;AAAA,YACjB,SAAS,KAAK;AAAA,YACd,gBAAgB,KAAK;AAAA,YACrB,UAAU,KAAK;AAAA,YACf,sBAAsB,QAAQ,oBAAoB;AAAA,UACpD;AAAA,QACF;AAAA,MACF;AAAA,IACF;AAGA,QAAI,KAAK,SAAS,uBAAuB,KAAK,SAAS,2BAA2B;AAChF,aAAO;AAAA,QACL,GAAG;AAAA,QACH,OAAO;AAAA,UACL,mBAAmB;AAAA,YACjB,GAAG;AAAA,YACH,SAAS,KAAK;AAAA,YACd,gBAAgB,KAAK;AAAA,YACrB,UAAU,KAAK;AAAA,YACf,sBAAsB,QAAQ,oBAAoB;AAAA,UACpD;AAAA,QACF;AAAA,MACF;AAAA,IACF;AAGA,QAAI,KAAK,SAAS,uBAAuB,KAAK,SAAS,2BAA2B;AAChF,aAAO;AAAA,QACL,GAAG;AAAA,QACH,OAAO;AAAA,UACL,mBAAmB;AAAA,YACjB,GAAG;AAAA,YACH,SAAS,KAAK;AAAA,YACd,gBAAgB,KAAK;AAAA,YACrB,UAAU,KAAK;AAAA,YACf,sBAAsB,QAAQ,oBAAoB;AAAA,UACpD;AAAA,QACF;AAAA,MACF;AAAA,IACF;AAAA,EACF;AAEA,SAAO;AACT;AAGO,MAAM,kBAAkB,CAAC,SAAiD;AAC/E,UAAQ,KAAK,8CAA8C;AAE3D,QAAM,kBAAkB,OAAO,OAAO,KAAK,eAAe,EAAE;AAAA,IAC1D,CAAC,MAAM,MAAM;AACX,YAAM,aAAa,OAAO,OAAO,KAAK,WAAW,EAAE,KAAK,CAAC,MAAM,EAAE,gBAAgB,SAAS,EAAE,GAAG,CAAC;AAChG,YAAM,OAAO,YAAY,OAAO,EAAE,GAAG;AACrC,UAAI,CAAC,MAAM;AACT,eAAO;AAAA,MACT;AAEA,YAAM,YAAY,sBAAsB,GAAG,IAAI;AAC/C,UAAI,WAAW;AACb,aAAK,EAAE,GAAG,IAAI;AAAA,MAChB;AAEA,aAAO;AAAA,IACT;AAAA,IACA,CAAC;AAAA,EACH;AAGA,QAAM,UAAU,KAAK;AAErB,SAAO;AAAA,IACL,GAAG;AAAA,IACH;AAAA,IACA;AAAA,EACF;AACF;",
  "names": []
}
