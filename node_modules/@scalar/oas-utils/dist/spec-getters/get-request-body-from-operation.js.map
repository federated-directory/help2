{
  "version": 3,
  "sources": ["../../src/spec-getters/get-request-body-from-operation.ts"],
  "sourcesContent": ["import { json2xml } from '@scalar/helpers/file/json2xml'\nimport type { ContentType } from '@scalar/types/legacy'\nimport { getResolvedRef } from '@scalar/workspace-store/helpers/get-resolved-ref'\n\nimport type { Operation } from '@/entities/spec'\nimport { normalizeMimeTypeObject } from '@/helpers/normalize-mime-type-object'\nimport { prettyPrintJson } from '@/helpers/pretty-print-json'\nimport { getExampleFromSchema } from './get-example-from-schema'\nimport { getParametersFromOperation } from './get-parameters-from-operation'\n\ntype AnyObject = Record<string, any>\n\n/**\n * Transform the object into a nested array of objects\n * that represent the key-value pairs of the object.\n */\nfunction getParamsFromObject(\n  obj: AnyObject,\n  nested = false,\n  field?: string,\n): {\n  name: string\n  value: any\n}[] {\n  return Object.entries(obj).flatMap(([key, value]) => {\n    const name = field ?? key\n\n    if (Array.isArray(value) && !nested) {\n      return getParamsFromObject(value, true, key)\n    }\n\n    if (typeof value === 'object' && !(value instanceof File) && value !== null) {\n      // Nested object inside formData field: no way to represent it, so just serialize to JSON string\n      value = JSON.stringify(value)\n    }\n\n    return [{ name, value }]\n  })\n}\n// Define preferred standard mime types (order indicates preference)\nconst standardMimeTypes: ContentType[] = [\n  'application/json',\n  'application/octet-stream',\n  'application/x-www-form-urlencoded',\n  'application/xml',\n  'multipart/form-data',\n  'text/plain',\n]\n\n/**\n * Get the request body from the operation.\n */\nexport function getRequestBodyFromOperation(\n  operation: Pick<Operation, 'requestBody' | 'parameters'>,\n  selectedExampleKey?: string | number,\n  omitEmptyAndOptionalProperties?: boolean,\n): {\n  mimeType: ContentType\n  text?: string | undefined\n  params?: {\n    name: string\n    value?: string | File\n  }[]\n} | null {\n  const originalContent = operation.requestBody?.content\n  const content = normalizeMimeTypeObject(originalContent)\n\n  // First try to find a standard mime type\n  const mimeType =\n    standardMimeTypes.find((currentMimeType) => !!content?.[currentMimeType]) ??\n    ((Object.keys(content ?? {})[0] || 'application/json') as ContentType)\n\n  // Handle JSON-like content types (e.g., application/vnd.github+json)\n  const isJsonLike = mimeType.includes('json') || mimeType.endsWith('+json')\n\n  /** Examples */\n  const examples = content?.[mimeType]?.examples ?? content?.['application/json']?.examples\n\n  // Let's use the first example\n  const selectedExample = examples?.[selectedExampleKey ?? Object.keys(examples ?? {})[0] ?? '']\n\n  if (selectedExample) {\n    return {\n      mimeType,\n      text: prettyPrintJson('value' in selectedExample ? selectedExample.value : selectedExample),\n    }\n  }\n\n  /**\n   * Body Parameters (Swagger 2.0)\n   *\n   * \u201DThe payload that's appended to the HTTP request. Since there can only be one payload, there can only\n   * be one body parameter. The name of the body parameter has no effect on the parameter itself and is used\n   * for documentation purposes only. Since Form parameters are also in the payload, body and form\n   * parameters cannot exist together for the same operation.\u201D\n   */\n  const bodyParameters = getParametersFromOperation(\n    operation.parameters ?? [],\n    // TODO: Add path parameters\n    [], // operation.path ?? [],\n    'body',\n    false,\n  )\n\n  if (bodyParameters.length > 0) {\n    return {\n      mimeType: 'application/json',\n      text: prettyPrintJson(bodyParameters[0]?.value ?? ''),\n    }\n  }\n\n  /**\n   * FormData Parameters (Swagger 2.0)\n   *\n   * \u201DForm - Used to describe the payload of an HTTP request when either application/x-www-form-urlencoded,\n   * multipart/form-data or both are used as the content type of the request (in Swagger's definition, the\n   * consumes property of an operation). This is the only parameter type that can be used to send files,\n   * thus supporting the file type. Since form parameters are sent in the payload, they cannot be declared\n   * together with a body parameter for the same operation. Form parameters have a different format based on\n   * the content-type used (for further details, consult http://www.w3.org/TR/html401/interact/forms.html#h-17.13.4):\n   * - application/x-www-form-urlencoded - Similar to the format of Query parameters but as a payload.\n   *   For example, foo=1&bar=swagger - both foo and bar are form parameters. This is normally used for simple\n   *   parameters that are being transferred.\n   * - multipart/form-data - each parameter takes a section in the payload with an internal header.\n   *   For example, for the header Content-Disposition: form-data; name=\"submit-name\" the name of the parameter is\n   *   submit-name. This type of form parameters is more commonly used for file transfers.\u201D\n   */\n\n  const formDataParameters = getParametersFromOperation(\n    operation.parameters ?? [],\n    // TODO: Add path parameters\n    [], // operation.path ?? [],\n    'formData',\n    false,\n  )\n\n  if (formDataParameters.length > 0) {\n    return {\n      mimeType: 'application/x-www-form-urlencoded',\n      params: formDataParameters.map((parameter) => ({\n        name: parameter.name,\n        /**\n         * TODO: This value MUST be a string\n         * Figure out why this is not always a string\n         *\n         * JSON.stringify is a TEMPORARY fix\n         */\n        value: typeof parameter.value === 'string' ? parameter.value : JSON.stringify(parameter.value),\n      })),\n    }\n  }\n\n  // If no mime type is supported, exit early\n  if (!mimeType) {\n    return null\n  }\n\n  // Get the request body object for the mime type\n  const requestBodyObject = content?.[mimeType]\n\n  // Get example from operation\n  const example = requestBodyObject?.example ? requestBodyObject?.example : undefined\n\n  // Update the JSON handling section\n  if (isJsonLike) {\n    const exampleFromSchema = requestBodyObject?.schema\n      ? getExampleFromSchema(getResolvedRef(requestBodyObject?.schema), {\n          mode: 'write',\n          omitEmptyAndOptionalProperties: omitEmptyAndOptionalProperties ?? false,\n        })\n      : null\n\n    const body = example ?? exampleFromSchema\n\n    return {\n      mimeType,\n      text: body ? (typeof body === 'string' ? body : JSON.stringify(body, null, 2)) : undefined,\n    }\n  }\n\n  // XML\n  if (mimeType === 'application/xml') {\n    const exampleFromSchema = requestBodyObject?.schema\n      ? getExampleFromSchema(getResolvedRef(requestBodyObject?.schema), {\n          xml: true,\n          mode: 'write',\n        })\n      : null\n\n    return {\n      mimeType,\n      text: example ?? json2xml(exampleFromSchema),\n    }\n  }\n\n  // Binary data\n  if (mimeType === 'application/octet-stream') {\n    return {\n      mimeType,\n      text: 'BINARY',\n    }\n  }\n\n  // Plain text\n  if (mimeType === 'text/plain') {\n    const exampleFromSchema = requestBodyObject?.schema\n      ? getExampleFromSchema(getResolvedRef(requestBodyObject?.schema), {\n          xml: true,\n          mode: 'write',\n        })\n      : null\n\n    return {\n      mimeType,\n      text: example ?? exampleFromSchema ?? '',\n    }\n  }\n\n  // URL encoded data\n  if (mimeType === 'multipart/form-data' || mimeType === 'application/x-www-form-urlencoded') {\n    const exampleFromSchema = requestBodyObject?.schema\n      ? getExampleFromSchema(getResolvedRef(requestBodyObject?.schema), {\n          xml: true,\n          mode: 'write',\n        })\n      : null\n\n    return {\n      mimeType,\n      params: getParamsFromObject(example ?? exampleFromSchema ?? {}),\n    }\n  }\n\n  return null\n}\n"],
  "mappings": "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",
  "names": []
}
