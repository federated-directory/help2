{
  "version": 3,
  "sources": ["../../src/helpers/parse.ts"],
  "sourcesContent": ["import type { UnknownObject } from '@scalar/types/utils'\nimport { parse, stringify } from 'yaml'\n\ntype PrimitiveOrObject = object | string | null | number | boolean | undefined\n\n/** Yaml handling with optional safeparse */\nexport const yaml = {\n  /** Parse and throw if the return value is not an object */\n  parse: (val: string) => {\n    const yamlObject = parse(val, { merge: true, maxAliasCount: 10000 })\n    if (typeof yamlObject !== 'object') {\n      throw Error('Invalid YAML object')\n    }\n    return yamlObject as UnknownObject\n  },\n  /** Parse and return a fallback on failure */\n  parseSafe<T extends PrimitiveOrObject>(val: string, fallback: T | ((err: any) => T)): UnknownObject | T {\n    try {\n      return yaml.parse(val)\n    } catch (err: any) {\n      return typeof fallback === 'function' ? fallback(err) : fallback\n    }\n  },\n  stringify,\n}\n\n/** JSON handling with optional safeparse */\nexport const json = {\n  /** Parse and throw if the return value is not an object */\n  parse: (val: string): UnknownObject => {\n    const jsonObject = JSON.parse(val)\n    if (typeof jsonObject !== 'object') {\n      throw Error('Invalid JSON object')\n    }\n    return jsonObject\n  },\n  /** Parse and return a fallback on failure */\n  parseSafe<T extends PrimitiveOrObject>(val: string, fallback: T | ((err: any) => T)): UnknownObject | T {\n    try {\n      return json.parse(val)\n    } catch (err) {\n      return typeof fallback === 'function' ? fallback(err) : fallback\n    }\n  },\n  stringify: (val: object) => JSON.stringify(val),\n}\n\n/**\n * Check if value is a valid JSON string\n */\nexport const isJsonString = (value?: any) => {\n  if (typeof value !== 'string') {\n    return false\n  }\n\n  return !!json.parseSafe(value, false)\n}\n\n/**\n * This helper is used to transform the content of the swagger file to JSON, even it was YAML.\n */\nexport const transformToJson = (value: string) => {\n  // Try json, then fallback to yaml, then fallback to string\n  return JSON.stringify(json.parseSafe(value, yaml.parseSafe(value, value)))\n}\n\n/** Validates a JSON string if provided. Otherwise returns the raw YAML */\nexport function formatJsonOrYamlString(value: string) {\n  // If we don't start with a bracket assume yaml\n  const trimmed = value.trim()\n  if (trimmed[0] !== '{' && trimmed[0] !== '[') {\n    return value\n  }\n\n  try {\n    // JSON\n    return JSON.stringify(JSON.parse(value), null, 2)\n  } catch {\n    // YAML\n    return value\n  }\n}\n\n/** Parse JSON or YAML into an object */\nexport const parseJsonOrYaml = (value: string | UnknownObject): UnknownObject => {\n  if (typeof value !== 'string') {\n    return value\n  }\n\n  const jsonObject = json.parseSafe(value, null)\n  if (jsonObject) {\n    return jsonObject\n  }\n\n  // Value is probably supposed to be JSON. Throw\n  if (value.length > 0 && ['{', '['].includes(value[0] ?? '')) {\n    throw Error('Invalid JSON or YAML')\n  }\n\n  return yaml.parseSafe(value, (err) => {\n    throw Error(err)\n  })\n}\n"],
  "mappings": "AACA,SAAS,OAAO,iBAAiB;AAK1B,MAAM,OAAO;AAAA;AAAA,EAElB,OAAO,CAAC,QAAgB;AACtB,UAAM,aAAa,MAAM,KAAK,EAAE,OAAO,MAAM,eAAe,IAAM,CAAC;AACnE,QAAI,OAAO,eAAe,UAAU;AAClC,YAAM,MAAM,qBAAqB;AAAA,IACnC;AACA,WAAO;AAAA,EACT;AAAA;AAAA,EAEA,UAAuC,KAAa,UAAoD;AACtG,QAAI;AACF,aAAO,KAAK,MAAM,GAAG;AAAA,IACvB,SAAS,KAAU;AACjB,aAAO,OAAO,aAAa,aAAa,SAAS,GAAG,IAAI;AAAA,IAC1D;AAAA,EACF;AAAA,EACA;AACF;AAGO,MAAM,OAAO;AAAA;AAAA,EAElB,OAAO,CAAC,QAA+B;AACrC,UAAM,aAAa,KAAK,MAAM,GAAG;AACjC,QAAI,OAAO,eAAe,UAAU;AAClC,YAAM,MAAM,qBAAqB;AAAA,IACnC;AACA,WAAO;AAAA,EACT;AAAA;AAAA,EAEA,UAAuC,KAAa,UAAoD;AACtG,QAAI;AACF,aAAO,KAAK,MAAM,GAAG;AAAA,IACvB,SAAS,KAAK;AACZ,aAAO,OAAO,aAAa,aAAa,SAAS,GAAG,IAAI;AAAA,IAC1D;AAAA,EACF;AAAA,EACA,WAAW,CAAC,QAAgB,KAAK,UAAU,GAAG;AAChD;AAKO,MAAM,eAAe,CAAC,UAAgB;AAC3C,MAAI,OAAO,UAAU,UAAU;AAC7B,WAAO;AAAA,EACT;AAEA,SAAO,CAAC,CAAC,KAAK,UAAU,OAAO,KAAK;AACtC;AAKO,MAAM,kBAAkB,CAAC,UAAkB;AAEhD,SAAO,KAAK,UAAU,KAAK,UAAU,OAAO,KAAK,UAAU,OAAO,KAAK,CAAC,CAAC;AAC3E;AAGO,SAAS,uBAAuB,OAAe;AAEpD,QAAM,UAAU,MAAM,KAAK;AAC3B,MAAI,QAAQ,CAAC,MAAM,OAAO,QAAQ,CAAC,MAAM,KAAK;AAC5C,WAAO;AAAA,EACT;AAEA,MAAI;AAEF,WAAO,KAAK,UAAU,KAAK,MAAM,KAAK,GAAG,MAAM,CAAC;AAAA,EAClD,QAAQ;AAEN,WAAO;AAAA,EACT;AACF;AAGO,MAAM,kBAAkB,CAAC,UAAiD;AAC/E,MAAI,OAAO,UAAU,UAAU;AAC7B,WAAO;AAAA,EACT;AAEA,QAAM,aAAa,KAAK,UAAU,OAAO,IAAI;AAC7C,MAAI,YAAY;AACd,WAAO;AAAA,EACT;AAGA,MAAI,MAAM,SAAS,KAAK,CAAC,KAAK,GAAG,EAAE,SAAS,MAAM,CAAC,KAAK,EAAE,GAAG;AAC3D,UAAM,MAAM,sBAAsB;AAAA,EACpC;AAEA,SAAO,KAAK,UAAU,OAAO,CAAC,QAAQ;AACpC,UAAM,MAAM,GAAG;AAAA,EACjB,CAAC;AACH;",
  "names": []
}
