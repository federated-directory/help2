/** Redirects the request to a proxy server with a given URL. */
function redirectToProxy(proxy, url) {
    if (!shouldUseProxy(proxy, url)) {
        return url ?? '';
    }
    // Create new URL object from url
    const newUrl = new URL(url);
    // Rewrite the URL with the proxy
    newUrl.href = proxy;
    // Add the original URL as a query parameter
    newUrl.searchParams.append('scalar_url', url);
    return newUrl.toString();
}
/** Returns false for requests to localhost, relative URLs, if no proxy is defined â€¦ */
function shouldUseProxy(proxy, url) {
    // No proxy or url
    if (!proxy || !url) {
        return false;
    }
    // Relative URLs
    if (!url.startsWith('http://') && !url.startsWith('https://')) {
        return false;
    }
    // Requests to localhost
    if (isRequestToLocalhost(url)) {
        return false;
    }
    return true;
}
/** Detect requests to localhost */
function isRequestToLocalhost(url) {
    const { hostname } = new URL(url);
    const listOfLocalUrls = ['localhost', '127.0.0.1', '[::1]'];
    return listOfLocalUrls.includes(hostname);
}

export { isRequestToLocalhost, redirectToProxy, shouldUseProxy };
