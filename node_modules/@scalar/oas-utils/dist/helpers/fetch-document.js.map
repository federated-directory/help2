{
  "version": 3,
  "sources": ["../../src/helpers/fetch-document.ts"],
  "sourcesContent": ["import { redirectToProxy } from '@scalar/helpers/url/redirect-to-proxy'\n\nimport { formatJsonOrYamlString } from './parse'\n\n// Doesn't work\nconst OLD_PROXY_URL = 'https://api.scalar.com/request-proxy'\n// Does work\nconst NEW_PROXY_URL = 'https://proxy.scalar.com'\n\n/**\n * Fetches an OpenAPI/Swagger document from a given URL\n *\n * @throws an error if the fetch fails\n */\nexport async function fetchDocument(\n  url: string,\n  proxyUrl?: string,\n  fetcher?: (input: string | URL | globalThis.Request, init?: RequestInit) => Promise<Response>,\n  prettyPrint = true,\n): Promise<string> {\n  // This replaces the OLD_PROXY_URL with the NEW_PROXY_URL on the fly.\n  if (proxyUrl === OLD_PROXY_URL) {\n    // biome-ignore lint/style/noParameterAssign: It's ok, let's make an exception here.\n    proxyUrl = NEW_PROXY_URL\n  }\n\n  const response = await (fetcher ? fetcher(url, undefined) : fetch(redirectToProxy(proxyUrl, url)))\n\n  // Looks like the request failed\n  if (response.status !== 200) {\n    console.error(`[fetchDocument] Failed to fetch the OpenAPI document from ${url} (Status: ${response.status})`)\n\n    if (!proxyUrl) {\n      console.warn(\n        `[fetchDocument] Tried to fetch the OpenAPI document from ${url} without a proxy. Are the CORS headers configured to allow cross-domain requests? https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS`,\n      )\n    }\n\n    throw new Error(`Failed to fetch the OpenAPI document from ${url} (Status: ${response.status})`)\n  }\n\n  // If it's JSON, make it pretty\n  if (prettyPrint) {\n    return formatJsonOrYamlString(await response.text())\n  }\n\n  return await response.text()\n}\n"],
  "mappings": "AAAA,SAAS,uBAAuB;AAEhC,SAAS,8BAA8B;AAGvC,MAAM,gBAAgB;AAEtB,MAAM,gBAAgB;AAOtB,eAAsB,cACpB,KACA,UACA,SACA,cAAc,MACG;AAEjB,MAAI,aAAa,eAAe;AAE9B,eAAW;AAAA,EACb;AAEA,QAAM,WAAW,OAAO,UAAU,QAAQ,KAAK,MAAS,IAAI,MAAM,gBAAgB,UAAU,GAAG,CAAC;AAGhG,MAAI,SAAS,WAAW,KAAK;AAC3B,YAAQ,MAAM,6DAA6D,GAAG,aAAa,SAAS,MAAM,GAAG;AAE7G,QAAI,CAAC,UAAU;AACb,cAAQ;AAAA,QACN,4DAA4D,GAAG;AAAA,MACjE;AAAA,IACF;AAEA,UAAM,IAAI,MAAM,6CAA6C,GAAG,aAAa,SAAS,MAAM,GAAG;AAAA,EACjG;AAGA,MAAI,aAAa;AACf,WAAO,uBAAuB,MAAM,SAAS,KAAK,CAAC;AAAA,EACrD;AAEA,SAAO,MAAM,SAAS,KAAK;AAC7B;",
  "names": []
}
