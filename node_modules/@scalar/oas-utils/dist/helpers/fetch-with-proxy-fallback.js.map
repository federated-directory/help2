{
  "version": 3,
  "sources": ["../../src/helpers/fetch-with-proxy-fallback.ts"],
  "sourcesContent": ["import { redirectToProxy, shouldUseProxy } from '@scalar/helpers/url/redirect-to-proxy'\n\nexport type FetchWithProxyFallbackOptions = {\n  proxyUrl: string | undefined\n  /**\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/Request/cache\n   */\n  cache?: RequestInit['cache']\n}\n\n/**\n * Fetches an OpenAPI document with a proxyUrl fallback mechanism.\n *\n * If a proxy is provided and the URL requires it, it will first attempt to fetch using the proxy.\n * If the proxy fetch fails or is not used, it will fall back to a direct fetch.\n */\nexport async function fetchWithProxyFallback(url: string, { proxyUrl, cache }: FetchWithProxyFallbackOptions) {\n  const fetchOptions = {\n    cache: cache || 'default',\n  }\n  const shouldTryProxy = shouldUseProxy(proxyUrl, url)\n  const initialUrl = shouldTryProxy ? redirectToProxy(proxyUrl, url) : url\n\n  try {\n    const result = await fetch(initialUrl, fetchOptions)\n\n    if (result.ok || !shouldTryProxy) {\n      return result\n    }\n\n    // Retry without proxyUrl if the initial request failed\n    return await fetch(url, fetchOptions)\n  } catch (error) {\n    if (shouldTryProxy) {\n      // If proxyUrl failed, try without it\n      return await fetch(url, fetchOptions)\n    }\n    throw error\n  }\n}\n"],
  "mappings": "AAAA,SAAS,iBAAiB,sBAAsB;AAgBhD,eAAsB,uBAAuB,KAAa,EAAE,UAAU,MAAM,GAAkC;AAC5G,QAAM,eAAe;AAAA,IACnB,OAAO,SAAS;AAAA,EAClB;AACA,QAAM,iBAAiB,eAAe,UAAU,GAAG;AACnD,QAAM,aAAa,iBAAiB,gBAAgB,UAAU,GAAG,IAAI;AAErE,MAAI;AACF,UAAM,SAAS,MAAM,MAAM,YAAY,YAAY;AAEnD,QAAI,OAAO,MAAM,CAAC,gBAAgB;AAChC,aAAO;AAAA,IACT;AAGA,WAAO,MAAM,MAAM,KAAK,YAAY;AAAA,EACtC,SAAS,OAAO;AACd,QAAI,gBAAgB;AAElB,aAAO,MAAM,MAAM,KAAK,YAAY;AAAA,IACtC;AACA,UAAM;AAAA,EACR;AACF;",
  "names": []
}
