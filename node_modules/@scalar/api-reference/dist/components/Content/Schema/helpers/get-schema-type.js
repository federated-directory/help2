import { getResolvedRef } from "@scalar/workspace-store/helpers/get-resolved-ref";
import { isArraySchema } from "@scalar/workspace-store/schemas/v3.1/strict/type-guards";
import { getRefName } from "./get-ref-name.js";
const formatArrayType = (itemType) => {
  if (!itemType) {
    return "array";
  }
  const wrappedItemType = itemType.includes(" | ") ? `(${itemType})` : itemType;
  return `array ${wrappedItemType}[]`;
};
const processArrayType = (value, isUnionType = false) => {
  if (!value.items) {
    return isUnionType ? "array" : value.title || value.xml?.name || "array";
  }
  const itemType = getSchemaType(value.items);
  const baseType = formatArrayType(itemType);
  if (isUnionType) {
    return baseType;
  }
  return value.nullable ? `${baseType} | null` : baseType;
};
const getSchemaType = (valueOrRef) => {
  if (!valueOrRef) {
    return "";
  }
  const value = getResolvedRef(valueOrRef);
  if (value.const !== void 0) {
    return "const";
  }
  if ("type" in value && Array.isArray(value.type)) {
    if (value.type.includes("array") && value.items) {
      const arrayType = processArrayType(value, true);
      const otherTypes = value.type.filter((t) => t !== "array");
      return otherTypes.length > 0 ? `${arrayType} | ${otherTypes.join(" | ")}` : arrayType;
    }
    return value.type.join(" | ");
  }
  if (isArraySchema(value)) {
    return processArrayType(value, false);
  }
  if (value.title) {
    return value.title;
  }
  if (value.xml?.name) {
    return value.xml.name;
  }
  if ("type" in value && value.type && value.contentEncoding) {
    return `${value.type} â€¢ ${value.contentEncoding}`;
  }
  if ("originalRef" in valueOrRef && valueOrRef.originalRef) {
    const refName = getRefName(valueOrRef.originalRef);
    if (refName) {
      return refName;
    }
  }
  if ("$ref" in valueOrRef) {
    const refName = getRefName(valueOrRef.$ref);
    if (refName) {
      return refName;
    }
  }
  return "type" in value ? value.type : "";
};
export {
  getSchemaType
};
