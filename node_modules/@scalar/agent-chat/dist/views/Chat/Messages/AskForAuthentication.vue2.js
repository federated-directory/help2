import { defineComponent as k, computed as a, createElementBlock as C, openBlock as u, normalizeClass as E, createElementVNode as v, createBlock as s, createCommentVNode as i, unref as l, withCtx as I, createTextVNode as N, createVNode as P } from "vue";
import { getSelectedServer as y } from "@scalar/api-client/v2/features/operation";
import { getActiveEnvironment as B, getServers as T } from "@scalar/api-client/v2/helpers";
import { ScalarButton as _ } from "@scalar/components";
import { ScalarIconArrowRight as w } from "@scalar/icons";
import x from "../../../components/AuthenticationProvided.vue.js";
import O from "../../../components/AuthenticationRequired.vue.js";
import { ASK_FOR_AUTHENTICATION_TOOL_NAME as b } from "../../../entities/tools/ask-for-authentication.js";
import { TOOL_NAMESPACE_SLUG_DELIMITER as z } from "../../../entities/tools/constants.js";
import { createDocumentName as L } from "../../../registry/create-document-name.js";
import { useState as M } from "../../../state/state.js";
import R from "../../Settings/Auth.vue.js";
const V = { class: "toggleButton" }, q = { class: "authContent" }, F = { class: "authContentInner" }, Z = /* @__PURE__ */ k({
  __name: "AskForAuthentication",
  props: {
    messagePart: {}
  },
  setup(t) {
    const { workspaceStore: d, eventBus: p, config: h, chat: f } = M(), o = a(() => {
      if (!t.messagePart.value.input?.uniqueIdentifier || t.messagePart.value.state !== "input-available")
        return;
      const [r, n] = t.messagePart.value.input.uniqueIdentifier.split(
        z
      );
      if (!(!r || !n))
        return L(r, n);
    }), e = a(() => {
      if (o.value)
        return d.workspace.documents[o.value];
    }), c = a(() => {
      if (e.value)
        return B(d, e.value);
    }), m = a(() => {
      if (!e.value)
        return;
      const r = T(e.value.servers, {
        documentUrl: e.value["x-scalar-original-source-url"]
      });
      return y(e.value, r);
    }), g = a(
      () => e?.value?.components?.securitySchemes ?? {}
    ), S = a(
      () => o.value && c.value && m.value
    );
    async function A() {
      await f.addToolOutput({
        toolCallId: t.messagePart.value.toolCallId,
        output: "Authentication provided.",
        tool: b,
        state: "output-available"
      }), await f.sendMessage();
    }
    return (r, n) => (u(), C("div", {
      class: E(["askForAuthentication", {
        open: S.value
      }])
    }, [
      v("div", V, [
        t.messagePart.value.state === "output-available" ? (u(), s(x, { key: 0 })) : i("", !0),
        t.messagePart.value.state === "input-available" ? (u(), s(O, { key: 1 })) : i("", !0),
        t.messagePart.value.state === "input-available" ? (u(), s(l(_), {
          key: 2,
          class: "authorizeButton",
          size: "xs",
          onClick: A
        }, {
          default: I(() => [
            n[0] || (n[0] = N(" Authorize ", -1)),
            P(l(w), { weight: "bold" })
          ]),
          _: 1
        })) : i("", !0)
      ]),
      v("div", q, [
        v("div", F, [
          o.value && e.value && c.value && m.value ? (u(), s(R, {
            key: 0,
            document: e.value,
            environment: c.value,
            eventBus: l(p),
            name: o.value,
            options: l(h),
            securitySchemes: g.value,
            selectedServer: m.value
          }, null, 8, ["document", "environment", "eventBus", "name", "options", "securitySchemes", "selectedServer"])) : i("", !0)
        ])
      ])
    ], 2));
  }
});
export {
  Z as default
};
