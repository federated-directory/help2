import { bundle as f } from "@scalar/json-magic/bundle";
import { fetchUrls as l } from "@scalar/json-magic/bundle/plugins/browser";
import { restoreAuthSecretsFromStorage as p } from "../helpers.js";
import { createDocumentName as D } from "./create-document-name.js";
async function x({
  namespace: t,
  slug: e,
  workspaceStore: o,
  registryDocuments: r,
  registryUrl: m,
  config: u,
  api: c,
  removable: i
}) {
  const a = await c.getDocument({
    namespace: t,
    slug: e
  });
  if (!a.success)
    return;
  r.value.push({ ...a.data, removable: i });
  const s = new URL(`/@${t}/apis/${e}/latest`, m), d = await f(s.toString(), {
    plugins: [l()],
    treeShake: !1
  }), n = D(t, e);
  return await o.addDocument(
    {
      name: n,
      document: d
    },
    u
  ), o.update("x-scalar-active-document", n), p({ documentName: n, workspaceStore: o }), a.data;
}
export {
  x as loadDocument
};
