import{getEntrypoint as e}from"../getEntrypoint.js";import{getListOfReferences as i}from"../getListOfReferences.js";import{makeFilesystem as n}from"../makeFilesystem.js";import{normalize as t}from"../normalize.js";async function s(f,m){if(m?.filesystem&&m?.filesystem.find((e=>e.filename===f)))return{filesystem:m.filesystem};const l=m?.plugins?.find((e=>e.check(f))),o=t(l?await l.get(f):f);if(void 0===o)return{filesystem:[]};let r=n(o,{filename:m?.filename??null});const a=(m?.filename?r.find((e=>e.filename===m?.filename)):e(r)).references??i(o);if(0===a.length)return{filesystem:r};for(const e of a){const i=m?.plugins?.find((i=>i.check(e)));if(!i)continue;const n=i.check(e)&&i.resolvePath?i.resolvePath(f,e):e;if(r.find((i=>i.filename===e)))continue;const{filesystem:t}=await s(n,{...m,filename:e});r=[...r,...t.map((e=>({...e,isEntrypoint:!1})))]}return{filesystem:r}}export{s as load};
