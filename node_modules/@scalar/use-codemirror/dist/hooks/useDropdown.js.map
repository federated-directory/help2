{
  "version": 3,
  "sources": ["../../src/hooks/useDropdown.ts"],
  "sourcesContent": ["import type { EditorView } from '@codemirror/view'\nimport { type Ref, watch } from 'vue'\n\n/** Custom hook to manage a dropdown in a CodeMirror editor */\nexport function useDropdown(params: {\n  codeMirror: Ref<EditorView | null>\n  onSelect?: (item: string) => void\n  query: Ref<string>\n  showDropdown: Ref<boolean>\n  dropdownPosition: Ref<{ left: number; top: number }>\n}) {\n  const { codeMirror, query, showDropdown, dropdownPosition } = params\n\n  function getCursorPos() {\n    return codeMirror.value?.state.selection.main.head || 0\n  }\n\n  function getCoordsAtPos(pos: number) {\n    return codeMirror.value?.coordsAtPos(pos)\n  }\n\n  /** Updates position of the dropdown based on the current cursor position */\n  function updateDropdownPosition() {\n    const cursorPos = getCursorPos()\n    requestAnimationFrame(() => {\n      const coords = getCoordsAtPos(cursorPos - query.value.length - 2)\n      if (coords) {\n        dropdownPosition.value = {\n          left: coords.left,\n          top: Math.max(coords.bottom),\n        }\n      }\n    })\n  }\n\n  // Watch for changes in the query and update the dropdown position\n  watch(query, updateDropdownPosition)\n\n  /** Inserts selected item at the current cursor position */\n  function handleDropdownSelect(item: string) {\n    const formattedItem = `{{${item}}}`\n    const cursor = getCursorPos()\n    const from = Math.max(0, cursor - query.value.length - 2)\n    const to = cursor\n    codeMirror.value?.dispatch({\n      changes: { from, to, insert: formattedItem },\n    })\n    showDropdown.value = false\n  }\n\n  /** Updates dropdown visibility based on current cursor position */\n  function updateDropdownVisibility() {\n    const cursor = getCursorPos()\n    const text = codeMirror.value?.state.doc.sliceString(0, cursor) || ''\n    const lastOpenBraceIndex = text.lastIndexOf('{{')\n    const lastCloseBraceIndex = text.lastIndexOf('}}')\n    if (lastOpenBraceIndex > lastCloseBraceIndex) {\n      query.value = text.slice(lastOpenBraceIndex + 2)\n      showDropdown.value = true\n      dropdownPosition.value = getCoordsAtPos(cursor) || { left: 0, top: 0 }\n      // Ensures dropdown position even if the query is empty\n      if (query.value === '') {\n        updateDropdownPosition()\n      }\n    } else {\n      showDropdown.value = false\n    }\n  }\n\n  // Watch for changes in the content and update the dropdown visibility\n  watch(() => codeMirror.value?.state.doc.toString(), updateDropdownVisibility)\n\n  return {\n    handleDropdownSelect,\n    updateDropdownVisibility,\n  }\n}\n"],
  "mappings": "AACA,SAAmB,aAAa;AAGzB,SAAS,YAAY,QAMzB;AACD,QAAM,EAAE,YAAY,OAAO,cAAc,iBAAiB,IAAI;AAE9D,WAAS,eAAe;AACtB,WAAO,WAAW,OAAO,MAAM,UAAU,KAAK,QAAQ;AAAA,EACxD;AAEA,WAAS,eAAe,KAAa;AACnC,WAAO,WAAW,OAAO,YAAY,GAAG;AAAA,EAC1C;AAGA,WAAS,yBAAyB;AAChC,UAAM,YAAY,aAAa;AAC/B,0BAAsB,MAAM;AAC1B,YAAM,SAAS,eAAe,YAAY,MAAM,MAAM,SAAS,CAAC;AAChE,UAAI,QAAQ;AACV,yBAAiB,QAAQ;AAAA,UACvB,MAAM,OAAO;AAAA,UACb,KAAK,KAAK,IAAI,OAAO,MAAM;AAAA,QAC7B;AAAA,MACF;AAAA,IACF,CAAC;AAAA,EACH;AAGA,QAAM,OAAO,sBAAsB;AAGnC,WAAS,qBAAqB,MAAc;AAC1C,UAAM,gBAAgB,KAAK,IAAI;AAC/B,UAAM,SAAS,aAAa;AAC5B,UAAM,OAAO,KAAK,IAAI,GAAG,SAAS,MAAM,MAAM,SAAS,CAAC;AACxD,UAAM,KAAK;AACX,eAAW,OAAO,SAAS;AAAA,MACzB,SAAS,EAAE,MAAM,IAAI,QAAQ,cAAc;AAAA,IAC7C,CAAC;AACD,iBAAa,QAAQ;AAAA,EACvB;AAGA,WAAS,2BAA2B;AAClC,UAAM,SAAS,aAAa;AAC5B,UAAM,OAAO,WAAW,OAAO,MAAM,IAAI,YAAY,GAAG,MAAM,KAAK;AACnE,UAAM,qBAAqB,KAAK,YAAY,IAAI;AAChD,UAAM,sBAAsB,KAAK,YAAY,IAAI;AACjD,QAAI,qBAAqB,qBAAqB;AAC5C,YAAM,QAAQ,KAAK,MAAM,qBAAqB,CAAC;AAC/C,mBAAa,QAAQ;AACrB,uBAAiB,QAAQ,eAAe,MAAM,KAAK,EAAE,MAAM,GAAG,KAAK,EAAE;AAErE,UAAI,MAAM,UAAU,IAAI;AACtB,+BAAuB;AAAA,MACzB;AAAA,IACF,OAAO;AACL,mBAAa,QAAQ;AAAA,IACvB;AAAA,EACF;AAGA,QAAM,MAAM,WAAW,OAAO,MAAM,IAAI,SAAS,GAAG,wBAAwB;AAE5E,SAAO;AAAA,IACL;AAAA,IACA;AAAA,EACF;AACF;",
  "names": []
}
