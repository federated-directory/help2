{
  "version": 3,
  "sources": ["../../src/mutators/tag.ts"],
  "sourcesContent": ["import type { WorkspaceStore } from '@/client'\nimport type { TagEvents } from '@/events/definitions/tag'\nimport { getResolvedRef } from '@/helpers/get-resolved-ref'\nimport { unpackProxyObject } from '@/helpers/unpack-proxy'\n\n/**\n * Adds a new tag to the WorkspaceDocument's `tags` array.\n *\n * If the document or its tags property does not exist, the function safely no-ops or initializes `tags` as needed.\n *\n * @param document - The target WorkspaceDocument\n * @param payload - The name of the tag to add\n */\nexport const createTag = (store: WorkspaceStore | null, payload: TagEvents['tag:create:tag']) => {\n  const document = store?.workspace.documents[payload.documentName]\n\n  if (!document) {\n    console.error('Document not found', { payload, store })\n    return\n  }\n\n  if (!document.tags) {\n    document.tags = []\n  }\n\n  document.tags.push({\n    name: payload.name,\n  })\n}\n\n/**\n * Deletes a tag from the workspace\n *\n * Example:\n * ```ts\n * deleteTag({\n *   document,\n *   name: 'tag',\n * })\n * ```\n */\nexport const deleteTag = (workspace: WorkspaceStore | null, payload: TagEvents['tag:delete:tag']) => {\n  const document = workspace?.workspace.documents[payload.documentName]\n  if (!document) {\n    return\n  }\n\n  // Clear tags from all operations that have this tag\n  Object.values(document.paths ?? {}).forEach((path) => {\n    Object.values(path).forEach((operation) => {\n      // Only process operations that are objects\n      if (typeof operation !== 'object' || Array.isArray(operation)) {\n        return\n      }\n\n      const resolvedOperation = getResolvedRef(operation)\n\n      if ('tags' in resolvedOperation) {\n        resolvedOperation.tags = unpackProxyObject(\n          resolvedOperation.tags?.filter((tag) => tag !== payload.name),\n          { depth: 2 },\n        )\n      }\n    })\n  })\n\n  // Remove the tag from all webhooks that have this tag\n  Object.values(document.webhooks ?? {}).forEach((webhook) => {\n    Object.values(webhook).forEach((operation) => {\n      if (typeof operation !== 'object' || Array.isArray(operation)) {\n        return\n      }\n\n      const resolvedOperation = getResolvedRef(operation)\n\n      resolvedOperation.tags = unpackProxyObject(\n        resolvedOperation.tags?.filter((tag) => tag !== payload.name),\n        { depth: 2 },\n      )\n    })\n  })\n\n  // Remove the tag from the document tags array\n  document.tags = unpackProxyObject(\n    document.tags?.filter((tag) => tag.name !== payload.name),\n    { depth: 2 },\n  )\n}\n\nexport const tagMutatorsFactory = ({ store }: { store: WorkspaceStore | null }) => {\n  return {\n    createTag: (payload: TagEvents['tag:create:tag']) => createTag(store, payload),\n    deleteTag: (payload: TagEvents['tag:delete:tag']) => deleteTag(store, payload),\n  }\n}\n"],
  "mappings": "AAEA,SAAS,sBAAsB;AAC/B,SAAS,yBAAyB;AAU3B,MAAM,YAAY,CAAC,OAA8B,YAAyC;AAC/F,QAAM,WAAW,OAAO,UAAU,UAAU,QAAQ,YAAY;AAEhE,MAAI,CAAC,UAAU;AACb,YAAQ,MAAM,sBAAsB,EAAE,SAAS,MAAM,CAAC;AACtD;AAAA,EACF;AAEA,MAAI,CAAC,SAAS,MAAM;AAClB,aAAS,OAAO,CAAC;AAAA,EACnB;AAEA,WAAS,KAAK,KAAK;AAAA,IACjB,MAAM,QAAQ;AAAA,EAChB,CAAC;AACH;AAaO,MAAM,YAAY,CAAC,WAAkC,YAAyC;AACnG,QAAM,WAAW,WAAW,UAAU,UAAU,QAAQ,YAAY;AACpE,MAAI,CAAC,UAAU;AACb;AAAA,EACF;AAGA,SAAO,OAAO,SAAS,SAAS,CAAC,CAAC,EAAE,QAAQ,CAAC,SAAS;AACpD,WAAO,OAAO,IAAI,EAAE,QAAQ,CAAC,cAAc;AAEzC,UAAI,OAAO,cAAc,YAAY,MAAM,QAAQ,SAAS,GAAG;AAC7D;AAAA,MACF;AAEA,YAAM,oBAAoB,eAAe,SAAS;AAElD,UAAI,UAAU,mBAAmB;AAC/B,0BAAkB,OAAO;AAAA,UACvB,kBAAkB,MAAM,OAAO,CAAC,QAAQ,QAAQ,QAAQ,IAAI;AAAA,UAC5D,EAAE,OAAO,EAAE;AAAA,QACb;AAAA,MACF;AAAA,IACF,CAAC;AAAA,EACH,CAAC;AAGD,SAAO,OAAO,SAAS,YAAY,CAAC,CAAC,EAAE,QAAQ,CAAC,YAAY;AAC1D,WAAO,OAAO,OAAO,EAAE,QAAQ,CAAC,cAAc;AAC5C,UAAI,OAAO,cAAc,YAAY,MAAM,QAAQ,SAAS,GAAG;AAC7D;AAAA,MACF;AAEA,YAAM,oBAAoB,eAAe,SAAS;AAElD,wBAAkB,OAAO;AAAA,QACvB,kBAAkB,MAAM,OAAO,CAAC,QAAQ,QAAQ,QAAQ,IAAI;AAAA,QAC5D,EAAE,OAAO,EAAE;AAAA,MACb;AAAA,IACF,CAAC;AAAA,EACH,CAAC;AAGD,WAAS,OAAO;AAAA,IACd,SAAS,MAAM,OAAO,CAAC,QAAQ,IAAI,SAAS,QAAQ,IAAI;AAAA,IACxD,EAAE,OAAO,EAAE;AAAA,EACb;AACF;AAEO,MAAM,qBAAqB,CAAC,EAAE,MAAM,MAAwC;AACjF,SAAO;AAAA,IACL,WAAW,CAAC,YAAyC,UAAU,OAAO,OAAO;AAAA,IAC7E,WAAW,CAAC,YAAyC,UAAU,OAAO,OAAO;AAAA,EAC/E;AACF;",
  "names": []
}
