{
  "version": 3,
  "sources": ["../../src/mutators/cookie.ts"],
  "sourcesContent": ["import type { CookieEvents } from '@/events/definitions/cookie'\nimport type { Workspace, WorkspaceDocument } from '@/schemas'\nimport { type XScalarCookie, xScalarCookieSchema } from '@/schemas/extensions/general/x-scalar-cookies'\nimport { coerceValue } from '@/schemas/typebox-coerce'\n\ntype Event<T extends keyof CookieEvents> = Omit<CookieEvents[T], 'collectionType'>\n\n/**\n * Adds OR updates a cookie to the document or workspace.\n *\n * @param document - current document if available\n * @param workspace - current workspace if available\n * @param payload - The cookie configuration to add or update\n * @param index - Optional index for updating an existing cookie\n * @param collectionType - Whether this is for a document or workspace\n * @returns the parsed cookie that was added or updated or undefined if the collection is not found\n */\nexport const upsertCookie = (\n  collection: WorkspaceDocument | Workspace | null,\n  { payload, index }: Event<'cookie:upsert:cookie'>,\n): XScalarCookie | undefined => {\n  if (!collection) {\n    return\n  }\n\n  if (!collection['x-scalar-cookies']) {\n    collection['x-scalar-cookies'] = []\n  }\n\n  if (index !== undefined) {\n    // Update existing cookie at index\n    if (index < 0 || index >= collection['x-scalar-cookies'].length) {\n      return\n    }\n\n    // Ensure we parse the payload but keep the existing cookie data\n    const parsed = coerceValue(xScalarCookieSchema, {\n      ...collection['x-scalar-cookies'][index],\n      ...payload,\n    })\n\n    // Update\n    collection['x-scalar-cookies'][index] = parsed\n    return parsed\n  }\n\n  // Add new cookie\n  const parsed = coerceValue(xScalarCookieSchema, payload)\n  collection['x-scalar-cookies'].push(parsed)\n  return parsed\n}\n\n/**\n * Deletes a cookie from the document or workspace by index.\n *\n * @param document - current document if available\n * @param workspace - current workspace if available\n * @param index - Index of the cookie to delete\n * @param collectionType - Whether this is for a document or workspace\n * @returns true if the cookie was deleted, false otherwise\n */\nexport const deleteCookie = (\n  collection: WorkspaceDocument | Workspace | null,\n  { index }: Event<'cookie:delete:cookie'>,\n): boolean => {\n  if (!collection || !collection['x-scalar-cookies']) {\n    return false\n  }\n\n  if (index < 0 || index >= collection['x-scalar-cookies'].length) {\n    return false\n  }\n\n  collection['x-scalar-cookies'].splice(index, 1)\n  return true\n}\n\nexport const cookieMutatorsFactory = ({ collection }: { collection: WorkspaceDocument | Workspace | null }) => {\n  return {\n    upsertCookie: (payload: Event<'cookie:upsert:cookie'>) => upsertCookie(collection, payload),\n    deleteCookie: (payload: Event<'cookie:delete:cookie'>) => deleteCookie(collection, payload),\n  }\n}\n"],
  "mappings": "AAEA,SAA6B,2BAA2B;AACxD,SAAS,mBAAmB;AAcrB,MAAM,eAAe,CAC1B,YACA,EAAE,SAAS,MAAM,MACa;AAC9B,MAAI,CAAC,YAAY;AACf;AAAA,EACF;AAEA,MAAI,CAAC,WAAW,kBAAkB,GAAG;AACnC,eAAW,kBAAkB,IAAI,CAAC;AAAA,EACpC;AAEA,MAAI,UAAU,QAAW;AAEvB,QAAI,QAAQ,KAAK,SAAS,WAAW,kBAAkB,EAAE,QAAQ;AAC/D;AAAA,IACF;AAGA,UAAMA,UAAS,YAAY,qBAAqB;AAAA,MAC9C,GAAG,WAAW,kBAAkB,EAAE,KAAK;AAAA,MACvC,GAAG;AAAA,IACL,CAAC;AAGD,eAAW,kBAAkB,EAAE,KAAK,IAAIA;AACxC,WAAOA;AAAA,EACT;AAGA,QAAM,SAAS,YAAY,qBAAqB,OAAO;AACvD,aAAW,kBAAkB,EAAE,KAAK,MAAM;AAC1C,SAAO;AACT;AAWO,MAAM,eAAe,CAC1B,YACA,EAAE,MAAM,MACI;AACZ,MAAI,CAAC,cAAc,CAAC,WAAW,kBAAkB,GAAG;AAClD,WAAO;AAAA,EACT;AAEA,MAAI,QAAQ,KAAK,SAAS,WAAW,kBAAkB,EAAE,QAAQ;AAC/D,WAAO;AAAA,EACT;AAEA,aAAW,kBAAkB,EAAE,OAAO,OAAO,CAAC;AAC9C,SAAO;AACT;AAEO,MAAM,wBAAwB,CAAC,EAAE,WAAW,MAA4D;AAC7G,SAAO;AAAA,IACL,cAAc,CAAC,YAA2C,aAAa,YAAY,OAAO;AAAA,IAC1F,cAAc,CAAC,YAA2C,aAAa,YAAY,OAAO;AAAA,EAC5F;AACF;",
  "names": ["parsed"]
}
