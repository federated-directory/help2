import { getResolvedRef } from "../helpers/get-resolved-ref.js";
import { unpackProxyObject } from "../helpers/unpack-proxy.js";
const createTag = (store, payload) => {
  const document = store?.workspace.documents[payload.documentName];
  if (!document) {
    console.error("Document not found", { payload, store });
    return;
  }
  if (!document.tags) {
    document.tags = [];
  }
  document.tags.push({
    name: payload.name
  });
};
const deleteTag = (workspace, payload) => {
  const document = workspace?.workspace.documents[payload.documentName];
  if (!document) {
    return;
  }
  Object.values(document.paths ?? {}).forEach((path) => {
    Object.values(path).forEach((operation) => {
      if (typeof operation !== "object" || Array.isArray(operation)) {
        return;
      }
      const resolvedOperation = getResolvedRef(operation);
      if ("tags" in resolvedOperation) {
        resolvedOperation.tags = unpackProxyObject(
          resolvedOperation.tags?.filter((tag) => tag !== payload.name),
          { depth: 2 }
        );
      }
    });
  });
  Object.values(document.webhooks ?? {}).forEach((webhook) => {
    Object.values(webhook).forEach((operation) => {
      if (typeof operation !== "object" || Array.isArray(operation)) {
        return;
      }
      const resolvedOperation = getResolvedRef(operation);
      resolvedOperation.tags = unpackProxyObject(
        resolvedOperation.tags?.filter((tag) => tag !== payload.name),
        { depth: 2 }
      );
    });
  });
  document.tags = unpackProxyObject(
    document.tags?.filter((tag) => tag.name !== payload.name),
    { depth: 2 }
  );
};
const tagMutatorsFactory = ({ store }) => {
  return {
    createTag: (payload) => createTag(store, payload),
    deleteTag: (payload) => deleteTag(store, payload)
  };
};
export {
  createTag,
  deleteTag,
  tagMutatorsFactory
};
//# sourceMappingURL=tag.js.map
