{
  "version": 3,
  "sources": ["../../src/mutators/document.ts"],
  "sourcesContent": ["import type { WorkspaceStore } from '@/client'\nimport type { DocumentEvents } from '@/events/definitions/document'\nimport { mergeObjects } from '@/helpers/merge-object'\nimport type { WorkspaceDocument } from '@/schemas'\n\n/**\n * Toggle setting selected security schemes at the operation level\n */\nexport const toggleSecurity = (document: WorkspaceDocument | null) => {\n  if (!document) {\n    return\n  }\n\n  document['x-scalar-set-operation-security'] = !document['x-scalar-set-operation-security']\n}\n\n/**\n * Updates the \"watch mode\" state of the given document.\n *\n * @param document WorkspaceDocument or null \u2013 The document to modify.\n * @param watchMode boolean \u2013 True enables watch mode, false disables it.\n *\n * If document is null, does nothing.\n */\nexport const updateWatchMode = (document: WorkspaceDocument | null, watchMode: boolean) => {\n  if (!document) {\n    return\n  }\n\n  // Set (or unset) the x-scalar-watch-mode property on the document\n  document['x-scalar-watch-mode'] = watchMode\n}\n\n/**\n * Updates the document's info object (typically, title, description, version, etc.).\n *\n * Uses a shallow merge: only properties present in payload will be overwritten or added.\n *\n * @param document WorkspaceDocument | null \u2013 The document whose info should be updated.\n * @param payload DocumentEvents['document:update:info'] \u2013 Partial info fields to update/merge.\n *\n * If document is null, does nothing.\n */\nexport const updateDocumentInfo = (\n  document: WorkspaceDocument | null,\n  payload: DocumentEvents['document:update:info'],\n) => {\n  if (!document) {\n    return\n  }\n  // Merge the given payload into the document's info object\n  mergeObjects(document.info, payload)\n\n  // Update the document title if it is present and the navigation object is present\n  // We do this because we don't want to rebuild the entire navigation object if only the title is changed\n  if (payload.title && document['x-scalar-navigation']) {\n    document['x-scalar-navigation'].title = payload.title\n  }\n}\n\n/**\n * Update the document icon and also update the corresponding sidebar entry\n *\n * Does not perform a sidebar rebuild for performance benefit\n */\nexport const updateDocumentIcon = (document: WorkspaceDocument | null, icon: string) => {\n  if (!document || !document['x-scalar-navigation']) {\n    return\n  }\n\n  // Update the document icon\n  document['x-scalar-icon'] = icon\n  // Update the sidebar document icon\n  document['x-scalar-navigation'].icon = icon\n}\n\n/**\n * Creates an empty OpenAPI document and adds it to the workspace.\n *\n * - If the store is null, this is a no-op.\n * - The document name must be unique; if already present, callback is called with `false`.\n * - On success, a new OpenAPI 3.1.0 document is added with a basic path and info.\n * - Callback is called with `true` if document is created.\n *\n * @param store WorkspaceStore | null \u2013 The workspace store to add the document to.\n * @param payload DocumentEvents['document:create:empty-document'] \u2013 Contains name, icon, and callback.\n */\nexport const createEmptyDocument = async (\n  store: WorkspaceStore | null,\n  payload: DocumentEvents['document:create:empty-document'],\n) => {\n  if (!store) {\n    return\n  }\n\n  // Check if the document already exists by name for uniqueness\n  if (store.workspace.documents[payload.name]) {\n    // Document name already exists, call callback with false\n    payload.callback?.(false)\n    return\n  }\n\n  // Add a new empty OpenAPI 3.1.0 document with minimal info and icon\n  await store.addDocument({\n    name: payload.name,\n    document: {\n      openapi: '3.1.0',\n      info: { title: payload.name, version: '1.0.0' },\n      paths: {\n        '/': {\n          get: {},\n        },\n      },\n      'x-scalar-icon': payload.icon,\n    },\n  })\n\n  // Notify success via callback\n  payload.callback?.(true)\n}\n\n/**\n * Deletes a document from the workspace by its name.\n *\n * Safely no-ops if the store is null.\n */\nexport const deleteDocument = (store: WorkspaceStore | null, payload: DocumentEvents['document:delete:document']) => {\n  if (!store) {\n    return\n  }\n\n  store.deleteDocument(payload.name)\n}\n\nexport const documentMutatorsFactory = ({\n  document,\n  store,\n}: {\n  document: WorkspaceDocument | null\n  store: WorkspaceStore | null\n}) => {\n  return {\n    toggleSecurity: () => toggleSecurity(document),\n    updateDocumentInfo: (payload: DocumentEvents['document:update:info']) => updateDocumentInfo(document, payload),\n    updateWatchMode: (payload: DocumentEvents['document:update:watch-mode']) => updateWatchMode(document, payload),\n    updateDocumentIcon: (payload: DocumentEvents['document:update:icon']) => updateDocumentIcon(document, payload),\n    createEmptyDocument: (payload: DocumentEvents['document:create:empty-document']) =>\n      createEmptyDocument(store, payload),\n    deleteDocument: (payload: DocumentEvents['document:delete:document']) => deleteDocument(store, payload),\n  }\n}\n"],
  "mappings": "AAEA,SAAS,oBAAoB;AAMtB,MAAM,iBAAiB,CAAC,aAAuC;AACpE,MAAI,CAAC,UAAU;AACb;AAAA,EACF;AAEA,WAAS,iCAAiC,IAAI,CAAC,SAAS,iCAAiC;AAC3F;AAUO,MAAM,kBAAkB,CAAC,UAAoC,cAAuB;AACzF,MAAI,CAAC,UAAU;AACb;AAAA,EACF;AAGA,WAAS,qBAAqB,IAAI;AACpC;AAYO,MAAM,qBAAqB,CAChC,UACA,YACG;AACH,MAAI,CAAC,UAAU;AACb;AAAA,EACF;AAEA,eAAa,SAAS,MAAM,OAAO;AAInC,MAAI,QAAQ,SAAS,SAAS,qBAAqB,GAAG;AACpD,aAAS,qBAAqB,EAAE,QAAQ,QAAQ;AAAA,EAClD;AACF;AAOO,MAAM,qBAAqB,CAAC,UAAoC,SAAiB;AACtF,MAAI,CAAC,YAAY,CAAC,SAAS,qBAAqB,GAAG;AACjD;AAAA,EACF;AAGA,WAAS,eAAe,IAAI;AAE5B,WAAS,qBAAqB,EAAE,OAAO;AACzC;AAaO,MAAM,sBAAsB,OACjC,OACA,YACG;AACH,MAAI,CAAC,OAAO;AACV;AAAA,EACF;AAGA,MAAI,MAAM,UAAU,UAAU,QAAQ,IAAI,GAAG;AAE3C,YAAQ,WAAW,KAAK;AACxB;AAAA,EACF;AAGA,QAAM,MAAM,YAAY;AAAA,IACtB,MAAM,QAAQ;AAAA,IACd,UAAU;AAAA,MACR,SAAS;AAAA,MACT,MAAM,EAAE,OAAO,QAAQ,MAAM,SAAS,QAAQ;AAAA,MAC9C,OAAO;AAAA,QACL,KAAK;AAAA,UACH,KAAK,CAAC;AAAA,QACR;AAAA,MACF;AAAA,MACA,iBAAiB,QAAQ;AAAA,IAC3B;AAAA,EACF,CAAC;AAGD,UAAQ,WAAW,IAAI;AACzB;AAOO,MAAM,iBAAiB,CAAC,OAA8B,YAAwD;AACnH,MAAI,CAAC,OAAO;AACV;AAAA,EACF;AAEA,QAAM,eAAe,QAAQ,IAAI;AACnC;AAEO,MAAM,0BAA0B,CAAC;AAAA,EACtC;AAAA,EACA;AACF,MAGM;AACJ,SAAO;AAAA,IACL,gBAAgB,MAAM,eAAe,QAAQ;AAAA,IAC7C,oBAAoB,CAAC,YAAoD,mBAAmB,UAAU,OAAO;AAAA,IAC7G,iBAAiB,CAAC,YAA0D,gBAAgB,UAAU,OAAO;AAAA,IAC7G,oBAAoB,CAAC,YAAoD,mBAAmB,UAAU,OAAO;AAAA,IAC7G,qBAAqB,CAAC,YACpB,oBAAoB,OAAO,OAAO;AAAA,IACpC,gBAAgB,CAAC,YAAwD,eAAe,OAAO,OAAO;AAAA,EACxG;AACF;",
  "names": []
}
