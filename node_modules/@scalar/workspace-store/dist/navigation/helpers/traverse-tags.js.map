{
  "version": 3,
  "sources": ["../../../src/navigation/helpers/traverse-tags.ts"],
  "sourcesContent": ["import { sortByOrder } from '@scalar/object-utils/arrays'\n\nimport { unpackProxyObject } from '@/helpers/unpack-proxy'\nimport { getXKeysFromObject } from '@/navigation/helpers/get-x-keys'\nimport type { TagsMap, TraverseSpecOptions } from '@/navigation/types'\nimport type { TraversedEntry, TraversedTag } from '@/schemas/navigation'\nimport type { OpenApiDocument, TagObject } from '@/schemas/v3.1/strict/openapi-document'\n\nimport { getTag } from './get-tag'\n\ntype Options = Pick<TraverseSpecOptions, 'tagsSorter' | 'operationsSorter' | 'generateId'>\n\n/** Creates a traversed tag entry from an OpenAPI tag object.\n *\n * @param tag - The OpenAPI tag object\n * @param entriesMap - Map to store tag IDs and titles for mobile header navigation\n * @param getTagId - Function to generate unique IDs for tags\n * @param children - Array of child entries (operations, webhooks, etc.)\n * @param isGroup - Whether this tag represents a group of tags\n * @returns A traversed tag entry with ID, title, name and children\n */\nconst createTagEntry = ({\n  tag,\n  generateId,\n  children,\n  isGroup = false,\n  parentId,\n}: {\n  tag: TagObject\n  generateId: TraverseSpecOptions['generateId']\n  children: TraversedEntry[]\n  isGroup: boolean\n  parentId: string\n}): TraversedTag => {\n  const id = generateId({\n    type: 'tag',\n    tag,\n    parentId,\n  })\n  const title = tag['x-displayName'] ?? tag.name ?? 'Untitled Tag'\n\n  // Update the order of the children based on the items\n  // This will ensure that the sort order is always in sync with the items\n  tag['x-scalar-order'] = children.map((child) => child.id)\n\n  const entry = {\n    id,\n    title,\n    name: tag.name || title,\n    description: tag.description,\n    children,\n    isGroup,\n    isWebhooks: false,\n    type: 'tag',\n    xKeys: getXKeysFromObject(unpackProxyObject(tag)),\n  } satisfies TraversedTag\n\n  return entry\n}\n\n/** Sorts and processes tags to create a hierarchical structure of tag entries.\n *\n * This function handles:\n * - Sorting tags alphabetically or using a custom sort function\n * - Sorting operations within tags by title, method, or custom function\n * - Filtering out internal and ignored tags\n * - Creating tag entries with their associated operations\n *\n * @param _keys - Array of tag keys to process\n * @param tagsMap - Map of tags and their entries\n * @param tagsDict - Dictionary of OpenAPI tags by name\n * @param titlesMap - Map of titles for the mobile header\n * @param options - Sorting and ID generation options\n * @returns Array of processed and sorted tag entries\n */\n/** Sorts tags and returns entries */\nconst getSortedTagEntries = ({\n  _keys,\n  tagsMap,\n  options: { tagsSorter, operationsSorter, generateId },\n  documentId,\n  sortOrder,\n}: {\n  _keys: string[]\n  /** Map of tags and their entries */\n  tagsMap: TagsMap\n  options: Options\n  documentId: string\n  sortOrder: string[] | undefined\n}) => {\n  /**\n   * Process each tag and its entries:\n   * - Skip internal and ignored tags\n   * - Sort operations within tags\n   * - Create tag entries with sorted operations\n   */\n  const entries = _keys.flatMap((key) => {\n    const { tag, entries } = getTag({ tagsMap, name: key, documentId, generateId })\n\n    // Skip if the tag is internal or scalar-ignore\n    if (tag['x-internal'] || tag['x-scalar-ignore']) {\n      return []\n    }\n\n    const sortOrder = tag['x-scalar-order']\n\n    if (sortOrder === undefined) {\n      // Alpha sort\n      if (operationsSorter === 'alpha') {\n        entries.sort((a, b) => (a.type === 'operation' && b.type === 'operation' ? a.title.localeCompare(b.title) : 0))\n      }\n      // Method sort\n      else if (operationsSorter === 'method') {\n        entries.sort((a, b) =>\n          a.type === 'operation' && b.type === 'operation' ? a.method.localeCompare(b.method) : 0,\n        )\n      }\n      // Custom sort\n      else if (typeof operationsSorter === 'function') {\n        entries.sort((a, b) => {\n          // Guard against tags\n          if (!(a.type === 'operation' || a.type === 'webhook') || !(b.type === 'operation' || b.type === 'webhook')) {\n            return 0\n          }\n\n          // Handle webhooks as well as operations\n          const pathA = a.type === 'operation' ? a.path : a.name\n          const pathB = b.type === 'operation' ? b.path : b.name\n\n          return operationsSorter(\n            { method: a.method, path: pathA, ref: a.ref, httpVerb: a.method },\n            { method: b.method, path: pathB, ref: b.ref, httpVerb: b.method },\n          )\n        })\n      }\n    }\n\n    return createTagEntry({\n      tag,\n      generateId,\n      children: sortOrder ? sortByOrder(entries, sortOrder, 'id') : entries,\n      parentId: documentId,\n      isGroup: false,\n    })\n  })\n\n  // If a custom 'x-scalar-order' is specified in the tag, sort the entries by this order using sortByOrder\n  if (sortOrder) {\n    return sortByOrder(entries, sortOrder, 'id')\n  }\n\n  // Alpha sort\n  if (tagsSorter === 'alpha') {\n    entries.sort((a, b) => {\n      const nameA =\n        getTag({\n          tagsMap,\n          name: a.title,\n          documentId,\n          generateId,\n        }).tag['x-displayName'] ||\n        a.title ||\n        'Untitled Tag'\n      const nameB =\n        getTag({ tagsMap, name: b.title, documentId, generateId }).tag['x-displayName'] || b.title || 'Untitled Tag'\n      return nameA.localeCompare(nameB)\n    })\n  }\n  // Custom sort\n  else if (typeof tagsSorter === 'function') {\n    entries.sort((a, b) =>\n      tagsSorter(\n        getTag({ tagsMap, name: a.name, documentId, generateId }).tag,\n        getTag({ tagsMap, name: b.name, documentId, generateId }).tag,\n      ),\n    )\n  }\n\n  return entries\n}\n\n/**\n * Traverses the tags map to create navigation entries, handling both grouped and ungrouped tags.\n *\n * This function processes the OpenAPI document's tags to:\n * - Handle tag groups if specified via x-tagGroups\n * - Sort tags and their operations according to provided sorters\n * - Create navigation entries for each tag or tag group\n */\nexport const traverseTags = ({\n  document,\n  tagsMap,\n  documentId,\n  options: { generateId, tagsSorter, operationsSorter },\n}: {\n  document: OpenApiDocument\n  /** Map of tags and their entries */\n  tagsMap: TagsMap\n  documentId: string\n  options: Options\n}): TraversedEntry[] => {\n  // x-tagGroups\n  if (document['x-tagGroups']) {\n    const tagGroups = document['x-tagGroups']\n\n    return tagGroups.flatMap((tagGroup) => {\n      const entries = getSortedTagEntries({\n        _keys: tagGroup.tags,\n        tagsMap,\n        options: { tagsSorter, operationsSorter, generateId },\n        documentId: documentId,\n        sortOrder: tagGroup['x-scalar-order'],\n      })\n\n      // Try to update the sort order of the tag group to keep it in sync with the items\n      tagGroup['x-scalar-order'] = entries.map((entry) => entry.id)\n\n      return entries.length\n        ? createTagEntry({\n            tag: tagGroup,\n            generateId,\n            children: entries,\n            parentId: documentId,\n            isGroup: true,\n          })\n        : []\n    })\n  }\n\n  // Ungrouped regular tags\n  const keys = Array.from(tagsMap.keys())\n\n  const tags = getSortedTagEntries({\n    _keys: keys,\n    tagsMap,\n    options: { generateId, tagsSorter, operationsSorter },\n    documentId: documentId,\n    sortOrder: document['x-scalar-order'],\n  })\n\n  return tags\n}\n"],
  "mappings": "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",
  "names": ["entries", "sortOrder"]
}
