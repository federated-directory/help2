{
  "version": 3,
  "sources": ["../../../src/navigation/helpers/traverse-schemas.ts"],
  "sourcesContent": ["import { getResolvedRef } from '@/helpers/get-resolved-ref'\nimport { getTag } from '@/navigation/helpers/get-tag'\nimport type { TagsMap, TraverseSpecOptions } from '@/navigation/types'\nimport type { ParentTag, TraversedSchema } from '@/schemas/navigation'\nimport type { OpenApiDocument, SchemaObject } from '@/schemas/v3.1/strict/openapi-document'\n\n/** Creates a traversed schema entry from an OpenAPI schema object.\n *\n * @param ref - JSON pointer reference to the schema in the OpenAPI document\n * @param name - Name of the schema, defaults to 'Unknown'\n * @param entriesMap - Map to store schema IDs and titles for mobile header navigation\n * @param getModelId - Function to generate unique IDs for schemas\n * @returns A traversed schema entry with ID, title, name and reference\n */\nconst createSchemaEntry = ({\n  ref,\n  name,\n  generateId,\n  parentTag,\n  _schema,\n  parentId,\n}: {\n  ref: string\n  name: string\n  generateId: TraverseSpecOptions['generateId']\n  parentTag?: ParentTag\n  _schema?: SchemaObject\n  parentId: string\n}): TraversedSchema => {\n  const id = generateId({ name, type: 'model', parentTag, parentId, schema: _schema })\n  const schema = getResolvedRef(_schema)\n\n  // Use schema.title if available, otherwise fall back to name\n  // @see https://json-schema.org/draft/2020-12/json-schema-core#section-4.3.5\n  const title = (schema && 'title' in schema && (schema.title as string)) || name\n\n  const entry = {\n    id,\n    title,\n    name,\n    ref,\n    type: 'model',\n  } satisfies TraversedSchema\n\n  return entry\n}\n\n/** Traverses the schemas in an OpenAPI document to build an array of model entries.\n *\n * This function processes each schema in components.schemas to:\n * - Filter out internal schemas (marked with x-internal) and schemas to ignore (marked with x-scalar-ignore)\n * - Create model entries with unique references and IDs\n * - Store model IDs and titles for mobile header navigation\n */\nexport const traverseSchemas = ({\n  document,\n  tagsMap,\n  generateId,\n  documentId,\n}: {\n  document: OpenApiDocument\n  /** Map of tagNames and their entries */\n  tagsMap: TagsMap\n  generateId: TraverseSpecOptions['generateId']\n  documentId: string\n}): TraversedSchema[] => {\n  const schemas = document.components?.schemas ?? {}\n  const untagged: TraversedSchema[] = []\n\n  // biome-ignore lint/suspicious/useGuardForIn: we do have an if statement after de-ref\n  for (const name in schemas) {\n    const schema = getResolvedRef(schemas[name])\n\n    if (schema?.['x-internal'] || schema?.['x-scalar-ignore'] || !Object.hasOwn(schemas, name)) {\n      continue\n    }\n\n    const ref = `#/components/schemas/${name}`\n\n    // Add to tags\n    if (schema?.['x-tags']) {\n      schema['x-tags'].forEach((tagName: string) => {\n        const { tag, id: tagId } = getTag({ tagsMap, name: tagName, documentId, generateId })\n        tagsMap.get(tagName)?.entries.push(\n          createSchemaEntry({\n            ref,\n            name,\n            generateId,\n            parentTag: { tag, id: tagId },\n            parentId: documentId,\n          }),\n        )\n      })\n    }\n    // Add to untagged\n    else {\n      untagged.push(\n        createSchemaEntry({\n          ref,\n          name,\n          generateId,\n          _schema: getResolvedRef(schemas[name]),\n          parentId: documentId,\n        }),\n      )\n    }\n  }\n\n  return untagged\n}\n"],
  "mappings": "AAAA,SAAS,sBAAsB;AAC/B,SAAS,cAAc;AAavB,MAAM,oBAAoB,CAAC;AAAA,EACzB;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AACF,MAOuB;AACrB,QAAM,KAAK,WAAW,EAAE,MAAM,MAAM,SAAS,WAAW,UAAU,QAAQ,QAAQ,CAAC;AACnF,QAAM,SAAS,eAAe,OAAO;AAIrC,QAAM,QAAS,UAAU,WAAW,UAAW,OAAO,SAAqB;AAE3E,QAAM,QAAQ;AAAA,IACZ;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA,MAAM;AAAA,EACR;AAEA,SAAO;AACT;AASO,MAAM,kBAAkB,CAAC;AAAA,EAC9B;AAAA,EACA;AAAA,EACA;AAAA,EACA;AACF,MAMyB;AACvB,QAAM,UAAU,SAAS,YAAY,WAAW,CAAC;AACjD,QAAM,WAA8B,CAAC;AAGrC,aAAW,QAAQ,SAAS;AAC1B,UAAM,SAAS,eAAe,QAAQ,IAAI,CAAC;AAE3C,QAAI,SAAS,YAAY,KAAK,SAAS,iBAAiB,KAAK,CAAC,OAAO,OAAO,SAAS,IAAI,GAAG;AAC1F;AAAA,IACF;AAEA,UAAM,MAAM,wBAAwB,IAAI;AAGxC,QAAI,SAAS,QAAQ,GAAG;AACtB,aAAO,QAAQ,EAAE,QAAQ,CAAC,YAAoB;AAC5C,cAAM,EAAE,KAAK,IAAI,MAAM,IAAI,OAAO,EAAE,SAAS,MAAM,SAAS,YAAY,WAAW,CAAC;AACpF,gBAAQ,IAAI,OAAO,GAAG,QAAQ;AAAA,UAC5B,kBAAkB;AAAA,YAChB;AAAA,YACA;AAAA,YACA;AAAA,YACA,WAAW,EAAE,KAAK,IAAI,MAAM;AAAA,YAC5B,UAAU;AAAA,UACZ,CAAC;AAAA,QACH;AAAA,MACF,CAAC;AAAA,IACH,OAEK;AACH,eAAS;AAAA,QACP,kBAAkB;AAAA,UAChB;AAAA,UACA;AAAA,UACA;AAAA,UACA,SAAS,eAAe,QAAQ,IAAI,CAAC;AAAA,UACrC,UAAU;AAAA,QACZ,CAAC;AAAA,MACH;AAAA,IACF;AAAA,EACF;AAEA,SAAO;AACT;",
  "names": []
}
