import { debounce } from "@scalar/helpers/general/debounce";
import { createWorkspaceStorePersistence } from "../../persistence/index.js";
const persistencePlugin = async ({
  workspaceId,
  debounceDelay = 500,
  /** Maximum time in milliseconds to wait before forcing execution, even with continuous calls. */
  maxWait = 1e4
}) => {
  const persistence = await createWorkspaceStorePersistence();
  const { execute } = debounce({ delay: debounceDelay, maxWait });
  return {
    hooks: {
      /**
       * Handles all workspace state change events.
       * Each write is debounced by a composite key to prevent frequent writes for the same entity.
       */
      onWorkspaceStateChanges(event) {
        if (event.type === "meta") {
          return execute(`meta-${workspaceId}`, () => persistence.meta.setItem(workspaceId, event.value));
        }
        if (event.type === "documents") {
          return execute(
            `documents-${workspaceId}-${event.documentName}`,
            () => persistence.documents.setItem(workspaceId, event.documentName, event.value)
          );
        }
        if (event.type === "intermediateDocuments") {
          return execute(
            `intermediateDocuments-${workspaceId}-${event.documentName}`,
            () => persistence.intermediateDocuments.setItem(workspaceId, event.documentName, event.value)
          );
        }
        if (event.type === "originalDocuments") {
          return execute(
            `originalDocuments-${workspaceId}-${event.documentName}`,
            () => persistence.originalDocuments.setItem(workspaceId, event.documentName, event.value)
          );
        }
        if (event.type === "overrides") {
          return execute(
            `overrides-${workspaceId}-${event.documentName}`,
            () => persistence.overrides.setItem(workspaceId, event.documentName, event.value)
          );
        }
        if (event.type === "deleteDocument") {
          return execute(
            `deleteDocument-${workspaceId}-${event.documentName}`,
            () => persistence.workspace.deleteDocument(workspaceId, event.documentName)
          );
        }
        return;
      }
    }
  };
};
export {
  persistencePlugin
};
//# sourceMappingURL=persistence.js.map
