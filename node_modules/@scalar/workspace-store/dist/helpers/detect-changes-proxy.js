import { isObject } from "@scalar/helpers/object/is-object";
const isDetectChangesProxy = Symbol("isDetectChangesProxy");
const detectChangesProxyTarget = Symbol("detectChangesProxyTarget");
const createDetectChangesProxy = (target, options, args = {
  proxyCache: /* @__PURE__ */ new WeakMap(),
  path: []
}) => {
  if (!isObject(target) && !Array.isArray(target)) {
    return target;
  }
  if (args.proxyCache.has(target)) {
    return args.proxyCache.get(target);
  }
  const proxy = new Proxy(target, {
    get(target2, prop, receiver) {
      if (prop === isDetectChangesProxy) {
        return true;
      }
      if (prop === detectChangesProxyTarget) {
        return target2;
      }
      const value = Reflect.get(target2, prop, receiver);
      if (isDetectChangesProxyObject(value)) {
        return value;
      }
      return createDetectChangesProxy(value, options, { ...args, path: [...args.path, String(prop)] });
    },
    set(target2, prop, value, receiver) {
      const path = [...args.path, String(prop)];
      options?.hooks?.onBeforeChange?.(path, value);
      const result = Reflect.set(target2, prop, value, receiver);
      options?.hooks?.onAfterChange?.(path, value);
      return result;
    }
  });
  args.proxyCache.set(target, proxy);
  return proxy;
};
const isDetectChangesProxyObject = (obj) => {
  return typeof obj === "object" && obj !== null && obj[isDetectChangesProxy] === true;
};
const unpackDetectChangesProxy = (obj) => {
  if (typeof obj !== "object" || obj === null) {
    return obj;
  }
  if (obj[isDetectChangesProxy]) {
    return obj[detectChangesProxyTarget];
  }
  return obj;
};
export {
  createDetectChangesProxy,
  isDetectChangesProxyObject,
  unpackDetectChangesProxy
};
//# sourceMappingURL=detect-changes-proxy.js.map
