import { isObject } from "@scalar/helpers/object/is-object";
const isOverridesProxy = Symbol("isOverridesProxy");
const getOverridesTarget = Symbol("getOverridesTarget");
const createOverridesProxy = (target, options, args = {
  cache: /* @__PURE__ */ new WeakMap()
}) => {
  if (!target || typeof target !== "object") {
    return target;
  }
  if (args.cache.has(target)) {
    return args.cache.get(target);
  }
  const { overrides } = options ?? {};
  const handler = {
    get(target2, prop, receiver) {
      if (prop === isOverridesProxy) {
        return true;
      }
      if (prop === getOverridesTarget) {
        return target2;
      }
      const value = Reflect.get(target2, prop, receiver);
      if (isOverridesProxyObject(value)) {
        return value;
      }
      if (!isObject(value)) {
        return Reflect.get(overrides ?? {}, prop) ?? value;
      }
      return createOverridesProxy(value, { overrides: Reflect.get(overrides ?? {}, prop) }, args);
    },
    set(target2, prop, value, receiver) {
      if (prop === isOverridesProxy || prop === getOverridesTarget) {
        return false;
      }
      const hasOverride = overrides && Reflect.has(overrides, prop);
      if (hasOverride && overrides && typeof overrides === "object") {
        ;
        overrides[prop] = value;
        return true;
      }
      return Reflect.set(target2, prop, value, receiver);
    }
  };
  const proxy = new Proxy(target, handler);
  args.cache.set(target, proxy);
  return proxy;
};
const isOverridesProxyObject = (obj) => {
  return typeof obj === "object" && obj !== null && obj[isOverridesProxy] === true;
};
function unpackOverridesProxy(input) {
  if (typeof input === "object" && input !== null && input[isOverridesProxy]) {
    return input[getOverridesTarget];
  }
  return input;
}
export {
  createOverridesProxy,
  getOverridesTarget,
  isOverridesProxyObject,
  unpackOverridesProxy
};
//# sourceMappingURL=overrides-proxy.js.map
