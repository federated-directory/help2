import { getRaw } from "@scalar/json-magic/magic-proxy";
import { toRaw } from "vue";
import { unpackDetectChangesProxy } from "../helpers/detect-changes-proxy.js";
import { unpackOverridesProxy } from "../helpers/overrides-proxy.js";
const unpackProxyObject = (input, { depth = 0 } = {}) => {
  const dfs = (value, currentDepth = 0) => {
    if (typeof value !== "object" || value === null) {
      return value;
    }
    const raw = unpackDetectChangesProxy(toRaw(getRaw(unpackOverridesProxy(value))));
    if (depth !== null && currentDepth >= depth) {
      return raw;
    }
    if (currentDepth !== 0 && raw !== value) {
      console.warn(
        "%c\u26A0 Warning:%c You tried to assign a proxied object (depth: %d).\n%c\u{1F4A1} Tip:%c Pass a plain object instead \u2014 wrapping a proxy inside another proxy may cause weird bugs.\n%c\u{1F50D} Debug Info:%c The problematic value is shown below:",
        // styles
        "background: #fdd835; color: #000; font-weight: bold; padding: 2px 4px; border-radius: 3px;",
        "color: inherit;",
        currentDepth,
        "color: #00bfa5; font-weight: bold;",
        "color: inherit;",
        "color: #03a9f4; font-weight: bold;",
        "color: inherit;",
        value,
        input
      );
      console.groupCollapsed("%c\u{1F4DC} Proxy assignment trace", "color: #9c27b0; font-weight: bold;");
      console.trace({ value, raw });
      console.groupEnd();
    }
    Object.entries(raw).forEach(([key, value2]) => {
      const propertyResult = dfs(value2, currentDepth + 1);
      const result = Reflect.set(raw, key, propertyResult);
      if (!result) {
        console.warn(
          '%c\u{1F6AB} Readonly Property Error:%c Failed to set property "%s" on object.\n%c\u{1F4A1} Tip:%c This property is readonly or non-configurable. You cannot unpack a readonly property \u2014 the value was not updated.\n%c\u{1F50D} Debug Info:%c Property: %s | Value: %o | Object: %o',
          // styles
          "background: #f44336; color: #fff; font-weight: bold; padding: 2px 4px; border-radius: 3px;",
          "color: inherit;",
          key,
          "color: #00bfa5; font-weight: bold;",
          "color: inherit;",
          "color: #03a9f4; font-weight: bold;",
          "color: inherit;",
          key,
          propertyResult,
          raw
        );
      }
    });
    return raw;
  };
  return dfs(input);
};
export {
  unpackProxyObject
};
//# sourceMappingURL=unpack-proxy.js.map
