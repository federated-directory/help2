{
  "version": 3,
  "sources": ["../../src/helpers/request-body.ts"],
  "sourcesContent": ["import type { OpenAPIV3_1 } from '@scalar/openapi-types'\n\nimport type { FormParameter, RequestBody, UrlEncodedParameter } from '@/types'\n\nimport { processFormDataSchema } from './form-data'\nimport { createParameterObject } from './parameters'\n\n/**\n * Extracts and converts the request body from a Postman request to an OpenAPI RequestBodyObject.\n * Handles raw JSON, form-data, and URL-encoded body types, creating appropriate schemas and content types.\n */\nexport function extractRequestBody(body: RequestBody): OpenAPIV3_1.RequestBodyObject {\n  const requestBody: OpenAPIV3_1.RequestBodyObject = {\n    content: {},\n  }\n\n  if (body.mode === 'raw') {\n    handleRawBody(body, requestBody)\n    return requestBody\n  }\n\n  if (body.mode === 'formdata' && body.formdata) {\n    handleFormDataBody(body.formdata, requestBody)\n    return requestBody\n  }\n\n  if (body.mode === 'urlencoded' && body.urlencoded) {\n    handleUrlEncodedBody(body.urlencoded, requestBody)\n    return requestBody\n  }\n\n  return requestBody\n}\n\nfunction handleRawBody(body: RequestBody, requestBody: OpenAPIV3_1.RequestBodyObject): void {\n  const rawBody = body.raw || ''\n  const isJsonLanguage = body.options?.raw?.language === 'json'\n\n  // Check if body contains Postman variables (like {{bodyData}})\n  const hasVariables = /\\{\\{[\\w-]+\\}\\}/.test(rawBody)\n\n  // Try parsing the raw body as JSON\n  // We use a boolean flag because `null` is a valid JSON value\n  let jsonBody: unknown\n  let isJsonBody = false\n  try {\n    jsonBody = JSON.parse(rawBody)\n    isJsonBody = true\n  } catch {\n    // Parsing failed - will handle below\n  }\n\n  // If we have valid JSON, use it\n  if (isJsonBody) {\n    requestBody.content = {\n      'application/json': {\n        schema: {\n          type: 'object',\n          example: jsonBody,\n        },\n      },\n    }\n    return\n  }\n\n  // If we have variables and JSON language but could not parse JSON,\n  // create a JSON schema placeholder\n  if (hasVariables && isJsonLanguage) {\n    requestBody.content = {\n      'application/json': {\n        schema: {\n          type: 'object',\n          description: 'Body data set via pre-request script',\n        },\n      },\n    }\n    return\n  }\n\n  // Fallback to text/plain\n  requestBody.content = {\n    'text/plain': {\n      schema: {\n        type: 'string',\n        examples: rawBody ? [rawBody] : undefined,\n      },\n    },\n  }\n}\n\nfunction handleFormDataBody(formdata: FormParameter[], requestBody: OpenAPIV3_1.RequestBodyObject): void {\n  requestBody.content = {\n    'multipart/form-data': {\n      schema: processFormDataSchema(formdata),\n    },\n  }\n}\n\nfunction handleUrlEncodedBody(urlencoded: UrlEncodedParameter[], requestBody: OpenAPIV3_1.RequestBodyObject): void {\n  const schema: OpenAPIV3_1.SchemaObject = {\n    type: 'object',\n    properties: {},\n    required: [],\n  }\n  urlencoded.forEach((item: UrlEncodedParameter) => {\n    if (schema.properties) {\n      const paramObject = createParameterObject(item, 'query')\n      const property: OpenAPIV3_1.SchemaObject = {\n        type: 'string',\n        examples: [item.value],\n        description: paramObject.description,\n      }\n      // Add x-scalar-disabled extension if parameter is disabled\n      if (item.disabled === true) {\n        property['x-scalar-disabled'] = true\n      }\n      schema.properties[item.key] = property\n      if (paramObject.required) {\n        schema.required?.push(item.key)\n      }\n    }\n  })\n  requestBody.content = {\n    'application/x-www-form-urlencoded': {\n      schema,\n    },\n  }\n}\n"],
  "mappings": "AAIA,SAAS,6BAA6B;AACtC,SAAS,6BAA6B;AAM/B,SAAS,mBAAmB,MAAkD;AACnF,QAAM,cAA6C;AAAA,IACjD,SAAS,CAAC;AAAA,EACZ;AAEA,MAAI,KAAK,SAAS,OAAO;AACvB,kBAAc,MAAM,WAAW;AAC/B,WAAO;AAAA,EACT;AAEA,MAAI,KAAK,SAAS,cAAc,KAAK,UAAU;AAC7C,uBAAmB,KAAK,UAAU,WAAW;AAC7C,WAAO;AAAA,EACT;AAEA,MAAI,KAAK,SAAS,gBAAgB,KAAK,YAAY;AACjD,yBAAqB,KAAK,YAAY,WAAW;AACjD,WAAO;AAAA,EACT;AAEA,SAAO;AACT;AAEA,SAAS,cAAc,MAAmB,aAAkD;AAC1F,QAAM,UAAU,KAAK,OAAO;AAC5B,QAAM,iBAAiB,KAAK,SAAS,KAAK,aAAa;AAGvD,QAAM,eAAe,iBAAiB,KAAK,OAAO;AAIlD,MAAI;AACJ,MAAI,aAAa;AACjB,MAAI;AACF,eAAW,KAAK,MAAM,OAAO;AAC7B,iBAAa;AAAA,EACf,QAAQ;AAAA,EAER;AAGA,MAAI,YAAY;AACd,gBAAY,UAAU;AAAA,MACpB,oBAAoB;AAAA,QAClB,QAAQ;AAAA,UACN,MAAM;AAAA,UACN,SAAS;AAAA,QACX;AAAA,MACF;AAAA,IACF;AACA;AAAA,EACF;AAIA,MAAI,gBAAgB,gBAAgB;AAClC,gBAAY,UAAU;AAAA,MACpB,oBAAoB;AAAA,QAClB,QAAQ;AAAA,UACN,MAAM;AAAA,UACN,aAAa;AAAA,QACf;AAAA,MACF;AAAA,IACF;AACA;AAAA,EACF;AAGA,cAAY,UAAU;AAAA,IACpB,cAAc;AAAA,MACZ,QAAQ;AAAA,QACN,MAAM;AAAA,QACN,UAAU,UAAU,CAAC,OAAO,IAAI;AAAA,MAClC;AAAA,IACF;AAAA,EACF;AACF;AAEA,SAAS,mBAAmB,UAA2B,aAAkD;AACvG,cAAY,UAAU;AAAA,IACpB,uBAAuB;AAAA,MACrB,QAAQ,sBAAsB,QAAQ;AAAA,IACxC;AAAA,EACF;AACF;AAEA,SAAS,qBAAqB,YAAmC,aAAkD;AACjH,QAAM,SAAmC;AAAA,IACvC,MAAM;AAAA,IACN,YAAY,CAAC;AAAA,IACb,UAAU,CAAC;AAAA,EACb;AACA,aAAW,QAAQ,CAAC,SAA8B;AAChD,QAAI,OAAO,YAAY;AACrB,YAAM,cAAc,sBAAsB,MAAM,OAAO;AACvD,YAAM,WAAqC;AAAA,QACzC,MAAM;AAAA,QACN,UAAU,CAAC,KAAK,KAAK;AAAA,QACrB,aAAa,YAAY;AAAA,MAC3B;AAEA,UAAI,KAAK,aAAa,MAAM;AAC1B,iBAAS,mBAAmB,IAAI;AAAA,MAClC;AACA,aAAO,WAAW,KAAK,GAAG,IAAI;AAC9B,UAAI,YAAY,UAAU;AACxB,eAAO,UAAU,KAAK,KAAK,GAAG;AAAA,MAChC;AAAA,IACF;AAAA,EACF,CAAC;AACD,cAAY,UAAU;AAAA,IACpB,qCAAqC;AAAA,MACnC;AAAA,IACF;AAAA,EACF;AACF;",
  "names": []
}
