{
  "version": 3,
  "sources": ["../../../../src/plugins/node/fetch/fetch.ts"],
  "sourcesContent": ["import type { Plugin } from '@scalar/types/snippetz'\n\nimport { createSearchParams } from '@/libs/http'\nimport { Raw, objectToString } from '@/libs/javascript'\n\n/**\n * node/fetch\n */\nexport const nodeFetch: Plugin = {\n  target: 'node',\n  client: 'fetch',\n  title: 'Fetch',\n  generate(request) {\n    // Defaults\n    const normalizedRequest = {\n      method: 'GET',\n      ...request,\n    }\n\n    let prefix = ''\n\n    // Normalization\n    normalizedRequest.method = normalizedRequest.method.toUpperCase()\n\n    // Reset fetch defaults\n    const options: Record<string, any> = {\n      method: normalizedRequest.method === 'GET' ? undefined : normalizedRequest.method,\n    }\n\n    // Query\n    const searchParams = createSearchParams(normalizedRequest.queryString)\n    const queryString = searchParams.size ? `?${searchParams.toString()}` : ''\n\n    // Headers\n    if (normalizedRequest.headers?.length) {\n      options.headers = {}\n\n      normalizedRequest.headers.forEach((header) => {\n        options.headers![header.name] = header.value\n      })\n    }\n\n    // Cookies\n    if (normalizedRequest.cookies?.length) {\n      options.headers = options.headers || {}\n\n      normalizedRequest.cookies.forEach((cookie) => {\n        options.headers!['Set-Cookie'] = options.headers!['Set-Cookie']\n          ? `${options.headers!['Set-Cookie']}; ${cookie.name}=${cookie.value}`\n          : `${cookie.name}=${cookie.value}`\n      })\n    }\n\n    // Remove undefined keys\n    Object.keys(options).forEach((key) => {\n      if (options[key] === undefined) {\n        delete options[key]\n      }\n    })\n\n    // Add body\n    if (normalizedRequest.postData) {\n      const { mimeType, text, params } = normalizedRequest.postData\n      let hasFsImport = false\n\n      if (mimeType === 'application/json' && text) {\n        try {\n          options.body = new Raw(`JSON.stringify(${objectToString(JSON.parse(text))})`)\n        } catch {\n          options.body = text\n        }\n      } else if (mimeType === 'multipart/form-data' && params) {\n        prefix = 'const formData = new FormData()\\n'\n        params.forEach((param) => {\n          if (param.fileName !== undefined) {\n            if (!hasFsImport) {\n              prefix = `import fs from 'node:fs'\\n\\n${prefix}`\n              hasFsImport = true\n            }\n            prefix += `formData.append('${param.name}', new Blob([fs.readFileSync('${param.fileName}')]), '${param.fileName}')\\n`\n          } else if (param.value !== undefined) {\n            prefix += `formData.append('${param.name}', '${param.value}')\\n`\n          }\n        })\n        prefix += '\\n'\n        options.body = new Raw('formData')\n      } else if (mimeType === 'application/x-www-form-urlencoded' && params) {\n        const form = Object.fromEntries(params.map((p) => [p.name, p.value]))\n        options.body = new Raw(`new URLSearchParams(${objectToString(form)})`)\n      } else {\n        options.body = normalizedRequest.postData.text\n      }\n    }\n\n    // Transform to JSON\n    const jsonOptions = Object.keys(options).length ? `, ${objectToString(options)}` : ''\n\n    // Code Template\n    return `${prefix}fetch('${normalizedRequest.url}${queryString}'${jsonOptions})`\n  },\n}\n"],
  "mappings": "AAEA,SAAS,0BAA0B;AACnC,SAAS,KAAK,sBAAsB;AAK7B,MAAM,YAAoB;AAAA,EAC/B,QAAQ;AAAA,EACR,QAAQ;AAAA,EACR,OAAO;AAAA,EACP,SAAS,SAAS;AAEhB,UAAM,oBAAoB;AAAA,MACxB,QAAQ;AAAA,MACR,GAAG;AAAA,IACL;AAEA,QAAI,SAAS;AAGb,sBAAkB,SAAS,kBAAkB,OAAO,YAAY;AAGhE,UAAM,UAA+B;AAAA,MACnC,QAAQ,kBAAkB,WAAW,QAAQ,SAAY,kBAAkB;AAAA,IAC7E;AAGA,UAAM,eAAe,mBAAmB,kBAAkB,WAAW;AACrE,UAAM,cAAc,aAAa,OAAO,IAAI,aAAa,SAAS,CAAC,KAAK;AAGxE,QAAI,kBAAkB,SAAS,QAAQ;AACrC,cAAQ,UAAU,CAAC;AAEnB,wBAAkB,QAAQ,QAAQ,CAAC,WAAW;AAC5C,gBAAQ,QAAS,OAAO,IAAI,IAAI,OAAO;AAAA,MACzC,CAAC;AAAA,IACH;AAGA,QAAI,kBAAkB,SAAS,QAAQ;AACrC,cAAQ,UAAU,QAAQ,WAAW,CAAC;AAEtC,wBAAkB,QAAQ,QAAQ,CAAC,WAAW;AAC5C,gBAAQ,QAAS,YAAY,IAAI,QAAQ,QAAS,YAAY,IAC1D,GAAG,QAAQ,QAAS,YAAY,CAAC,KAAK,OAAO,IAAI,IAAI,OAAO,KAAK,KACjE,GAAG,OAAO,IAAI,IAAI,OAAO,KAAK;AAAA,MACpC,CAAC;AAAA,IACH;AAGA,WAAO,KAAK,OAAO,EAAE,QAAQ,CAAC,QAAQ;AACpC,UAAI,QAAQ,GAAG,MAAM,QAAW;AAC9B,eAAO,QAAQ,GAAG;AAAA,MACpB;AAAA,IACF,CAAC;AAGD,QAAI,kBAAkB,UAAU;AAC9B,YAAM,EAAE,UAAU,MAAM,OAAO,IAAI,kBAAkB;AACrD,UAAI,cAAc;AAElB,UAAI,aAAa,sBAAsB,MAAM;AAC3C,YAAI;AACF,kBAAQ,OAAO,IAAI,IAAI,kBAAkB,eAAe,KAAK,MAAM,IAAI,CAAC,CAAC,GAAG;AAAA,QAC9E,QAAQ;AACN,kBAAQ,OAAO;AAAA,QACjB;AAAA,MACF,WAAW,aAAa,yBAAyB,QAAQ;AACvD,iBAAS;AACT,eAAO,QAAQ,CAAC,UAAU;AACxB,cAAI,MAAM,aAAa,QAAW;AAChC,gBAAI,CAAC,aAAa;AAChB,uBAAS;AAAA;AAAA,EAA+B,MAAM;AAC9C,4BAAc;AAAA,YAChB;AACA,sBAAU,oBAAoB,MAAM,IAAI,iCAAiC,MAAM,QAAQ,UAAU,MAAM,QAAQ;AAAA;AAAA,UACjH,WAAW,MAAM,UAAU,QAAW;AACpC,sBAAU,oBAAoB,MAAM,IAAI,OAAO,MAAM,KAAK;AAAA;AAAA,UAC5D;AAAA,QACF,CAAC;AACD,kBAAU;AACV,gBAAQ,OAAO,IAAI,IAAI,UAAU;AAAA,MACnC,WAAW,aAAa,uCAAuC,QAAQ;AACrE,cAAM,OAAO,OAAO,YAAY,OAAO,IAAI,CAAC,MAAM,CAAC,EAAE,MAAM,EAAE,KAAK,CAAC,CAAC;AACpE,gBAAQ,OAAO,IAAI,IAAI,uBAAuB,eAAe,IAAI,CAAC,GAAG;AAAA,MACvE,OAAO;AACL,gBAAQ,OAAO,kBAAkB,SAAS;AAAA,MAC5C;AAAA,IACF;AAGA,UAAM,cAAc,OAAO,KAAK,OAAO,EAAE,SAAS,KAAK,eAAe,OAAO,CAAC,KAAK;AAGnF,WAAO,GAAG,MAAM,UAAU,kBAAkB,GAAG,GAAG,WAAW,IAAI,WAAW;AAAA,EAC9E;AACF;",
  "names": []
}
