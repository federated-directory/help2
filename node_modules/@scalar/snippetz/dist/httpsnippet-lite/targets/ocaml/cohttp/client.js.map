{
  "version": 3,
  "sources": ["../../../../../src/httpsnippet-lite/targets/ocaml/cohttp/client.ts"],
  "sourcesContent": ["/**\n * @description\n * HTTP code snippet generator for OCaml using CoHTTP.\n *\n * @author\n * @SGrondin\n *\n * for any questions or issues regarding the generated code snippet, please open an issue mentioning the author.\n */\nimport { CodeBuilder } from '@/httpsnippet-lite/helpers/code-builder'\nimport { escapeForDoubleQuotes } from '@/httpsnippet-lite/helpers/escape'\nimport type { Client } from '@/httpsnippet-lite/targets/target'\n\nexport const cohttp: Client = {\n  info: {\n    key: 'cohttp',\n    title: 'CoHTTP',\n    link: 'https://github.com/mirage/ocaml-cohttp',\n    description: 'Cohttp is a very lightweight HTTP server using Lwt or Async for OCaml',\n  },\n  convert: ({ fullUrl, allHeaders, postData, method }, options) => {\n    const opts = {\n      indent: '  ',\n      ...options,\n    }\n    const methods = ['get', 'post', 'head', 'delete', 'patch', 'put', 'options']\n    const { push, blank, join } = new CodeBuilder({ indent: opts.indent })\n    push('open Cohttp_lwt_unix')\n    push('open Cohttp')\n    push('open Lwt')\n    blank()\n    push(`let uri = Uri.of_string \"${fullUrl}\" in`)\n    // Add headers, including the cookies\n    const headers = Object.keys(allHeaders)\n    if (headers.length === 1) {\n      push(\n        `let headers = Header.add (Header.init ()) \"${headers[0]}\" \"${escapeForDoubleQuotes(allHeaders[headers[0]!] as string)}\" in`,\n      )\n    } else if (headers.length > 1) {\n      push('let headers = Header.add_list (Header.init ()) [')\n      headers.forEach((key) => {\n        push(`(\"${key}\", \"${escapeForDoubleQuotes(allHeaders[key] as string)}\");`, 1)\n      })\n      push('] in')\n    }\n    // Add body\n    if (postData === null || postData === void 0 ? void 0 : postData.text) {\n      // Just text\n      push(`let body = Cohttp_lwt_body.of_string ${JSON.stringify(postData!.text)} in`)\n    }\n    // Do the request\n    blank()\n    const h = headers.length ? '~headers ' : ''\n    const b = (postData === null || postData === void 0 ? void 0 : postData.text) ? '~body ' : ''\n    const m = methods.includes(method.toLowerCase())\n      ? `\\`${method.toUpperCase()}`\n      : `(Code.method_of_string \"${method}\")`\n    push(`Client.call ${h}${b}${m} uri`)\n    // Catch result\n    push('>>= fun (res, body_stream) ->')\n    push('(* Do stuff with the result *)', 1)\n    return join()\n  },\n}\n"],
  "mappings": "AASA,SAAS,mBAAmB;AAC5B,SAAS,6BAA6B;AAG/B,MAAM,SAAiB;AAAA,EAC5B,MAAM;AAAA,IACJ,KAAK;AAAA,IACL,OAAO;AAAA,IACP,MAAM;AAAA,IACN,aAAa;AAAA,EACf;AAAA,EACA,SAAS,CAAC,EAAE,SAAS,YAAY,UAAU,OAAO,GAAG,YAAY;AAC/D,UAAM,OAAO;AAAA,MACX,QAAQ;AAAA,MACR,GAAG;AAAA,IACL;AACA,UAAM,UAAU,CAAC,OAAO,QAAQ,QAAQ,UAAU,SAAS,OAAO,SAAS;AAC3E,UAAM,EAAE,MAAM,OAAO,KAAK,IAAI,IAAI,YAAY,EAAE,QAAQ,KAAK,OAAO,CAAC;AACrE,SAAK,sBAAsB;AAC3B,SAAK,aAAa;AAClB,SAAK,UAAU;AACf,UAAM;AACN,SAAK,4BAA4B,OAAO,MAAM;AAE9C,UAAM,UAAU,OAAO,KAAK,UAAU;AACtC,QAAI,QAAQ,WAAW,GAAG;AACxB;AAAA,QACE,8CAA8C,QAAQ,CAAC,CAAC,MAAM,sBAAsB,WAAW,QAAQ,CAAC,CAAE,CAAW,CAAC;AAAA,MACxH;AAAA,IACF,WAAW,QAAQ,SAAS,GAAG;AAC7B,WAAK,kDAAkD;AACvD,cAAQ,QAAQ,CAAC,QAAQ;AACvB,aAAK,KAAK,GAAG,OAAO,sBAAsB,WAAW,GAAG,CAAW,CAAC,OAAO,CAAC;AAAA,MAC9E,CAAC;AACD,WAAK,MAAM;AAAA,IACb;AAEA,QAAI,aAAa,QAAQ,aAAa,SAAS,SAAS,SAAS,MAAM;AAErE,WAAK,wCAAwC,KAAK,UAAU,SAAU,IAAI,CAAC,KAAK;AAAA,IAClF;AAEA,UAAM;AACN,UAAM,IAAI,QAAQ,SAAS,cAAc;AACzC,UAAM,KAAK,aAAa,QAAQ,aAAa,SAAS,SAAS,SAAS,QAAQ,WAAW;AAC3F,UAAM,IAAI,QAAQ,SAAS,OAAO,YAAY,CAAC,IAC3C,KAAK,OAAO,YAAY,CAAC,KACzB,2BAA2B,MAAM;AACrC,SAAK,eAAe,CAAC,GAAG,CAAC,GAAG,CAAC,MAAM;AAEnC,SAAK,+BAA+B;AACpC,SAAK,kCAAkC,CAAC;AACxC,WAAO,KAAK;AAAA,EACd;AACF;",
  "names": []
}
