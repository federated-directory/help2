{
  "version": 3,
  "sources": ["../../../../../src/httpsnippet-lite/targets/objc/nsurlsession/client.ts"],
  "sourcesContent": ["/**\n * @description\n * HTTP code snippet generator for Objective-C using NSURLSession.\n *\n * @author\n * @thibaultCha\n *\n * for any questions or issues regarding the generated code snippet, please open an issue mentioning the author.\n */\n\nimport { CodeBuilder } from '@/httpsnippet-lite/helpers/code-builder'\nimport { nsDeclaration } from '@/httpsnippet-lite/targets/objc/helpers'\nimport type { Client } from '@/httpsnippet-lite/targets/target'\n\nexport const nsurlsession: Client = {\n  info: {\n    key: 'nsurlsession',\n    title: 'NSURLSession',\n    link: 'https://developer.apple.com/library/mac/documentation/Foundation/Reference/NSURLSession_class/index.html',\n    description: \"Foundation's NSURLSession request\",\n  },\n  convert: ({ allHeaders, postData, method, fullUrl }, options) => {\n    let _a\n    const opts = {\n      indent: '    ',\n      pretty: true,\n      timeout: 10,\n      ...options,\n    }\n    const { push, join, blank } = new CodeBuilder({ indent: opts.indent })\n    // Markers for headers to be created as literal objects and later be set on the NSURLRequest if exist\n    const req = {\n      hasHeaders: false,\n      hasBody: false,\n    }\n    // We just want to make sure people understand that is the only dependency\n    push('#import <Foundation/Foundation.h>')\n    if (Object.keys(allHeaders).length) {\n      req.hasHeaders = true\n      blank()\n      push(nsDeclaration('NSDictionary', 'headers', allHeaders, opts.pretty))\n    }\n    if (postData && (postData.text || postData.jsonObj || postData.params)) {\n      req.hasBody = true\n      switch (postData.mimeType) {\n        case 'application/x-www-form-urlencoded':\n          if ((_a = postData.params) === null || _a === void 0 ? void 0 : _a.length) {\n            // By appending parameters one by one in the resulting snippet,\n            // we make it easier for the user to edit it according to his or her needs after pasting.\n            // The user can just add/remove lines adding/removing body parameters.\n            blank()\n            const [head, ...tail] = postData.params!\n            push(\n              `NSMutableData *postData = [[NSMutableData alloc] initWithData:[@\"${head!.name}=${head!.value}\" dataUsingEncoding:NSUTF8StringEncoding]];`,\n            )\n            tail.forEach(({ name, value }) => {\n              push(`[postData appendData:[@\"&${name}=${value}\" dataUsingEncoding:NSUTF8StringEncoding]];`)\n            })\n          } else {\n            req.hasBody = false\n          }\n          break\n        case 'application/json':\n          if (postData.jsonObj) {\n            push(nsDeclaration('NSDictionary', 'parameters', postData.jsonObj, opts.pretty))\n            blank()\n            push('NSData *postData = [NSJSONSerialization dataWithJSONObject:parameters options:0 error:nil];')\n          }\n          break\n        case 'multipart/form-data':\n          // By appending multipart parameters one by one in the resulting snippet,\n          // we make it easier for the user to edit it according to his or her needs after pasting.\n          // The user can just edit the parameters NSDictionary or put this part of a snippet in a multipart builder method.\n          push(nsDeclaration('NSArray', 'parameters', postData.params || [], opts.pretty))\n          push(`NSString *boundary = @\"${postData.boundary}\";`)\n          blank()\n          push('NSError *error;')\n          push('NSMutableString *body = [NSMutableString string];')\n          push('for (NSDictionary *param in parameters) {')\n          push('[body appendFormat:@\"--%@\\\\r\\\\n\", boundary];', 1)\n          push('if (param[@\"fileName\"]) {', 1)\n          push(\n            '[body appendFormat:@\"Content-Disposition:form-data; name=\\\\\"%@\\\\\"; filename=\\\\\"%@\\\\\"\\\\r\\\\n\", param[@\"name\"], param[@\"fileName\"]];',\n            2,\n          )\n          push('[body appendFormat:@\"Content-Type: %@\\\\r\\\\n\\\\r\\\\n\", param[@\"contentType\"]];', 2)\n          push(\n            '[body appendFormat:@\"%@\", [NSString stringWithContentsOfFile:param[@\"fileName\"] encoding:NSUTF8StringEncoding error:&error]];',\n            2,\n          )\n          push('if (error) {', 2)\n          push('NSLog(@\"%@\", error);', 3)\n          push('}', 2)\n          push('} else {', 1)\n          push('[body appendFormat:@\"Content-Disposition:form-data; name=\\\\\"%@\\\\\"\\\\r\\\\n\\\\r\\\\n\", param[@\"name\"]];', 2)\n          push('[body appendFormat:@\"%@\", param[@\"value\"]];', 2)\n          push('}', 1)\n          push('}')\n          push('[body appendFormat:@\"\\\\r\\\\n--%@--\\\\r\\\\n\", boundary];')\n          push('NSData *postData = [body dataUsingEncoding:NSUTF8StringEncoding];')\n          break\n        default:\n          blank()\n          push(\n            `NSData *postData = [[NSData alloc] initWithData:[@\"${postData.text}\" dataUsingEncoding:NSUTF8StringEncoding]];`,\n          )\n      }\n    }\n    blank()\n    push(`NSMutableURLRequest *request = [NSMutableURLRequest requestWithURL:[NSURL URLWithString:@\"${fullUrl}\"]`)\n    // NSURLRequestUseProtocolCachePolicy is the default policy, let's just always set it to avoid confusion.\n    push('                                                       cachePolicy:NSURLRequestUseProtocolCachePolicy')\n    push(`                                                   timeoutInterval:${opts.timeout.toFixed(1)}];`)\n    push(`[request setHTTPMethod:@\"${method}\"];`)\n    if (req.hasHeaders) {\n      push('[request setAllHTTPHeaderFields:headers];')\n    }\n    if (req.hasBody) {\n      push('[request setHTTPBody:postData];')\n    }\n    blank()\n    // Retrieving the shared session will be less verbose than creating a new one.\n    push('NSURLSession *session = [NSURLSession sharedSession];')\n    push('NSURLSessionDataTask *dataTask = [session dataTaskWithRequest:request')\n    push(\n      '                                            completionHandler:^(NSData *data, NSURLResponse *response, NSError *error) {',\n    )\n    push('                                            if (error) {', 1)\n    push('                                            NSLog(@\"%@\", error);', 2)\n    push('                                            } else {', 1)\n    // Casting the NSURLResponse to NSHTTPURLResponse so the user can see the status     .\n    push(\n      '                                            NSHTTPURLResponse *httpResponse = (NSHTTPURLResponse *) response;',\n      2,\n    )\n    push('                                            NSLog(@\"%@\", httpResponse);', 2)\n    push('                                            }', 1)\n    push('                                            }];')\n    push('[dataTask resume];')\n    return join()\n  },\n}\n"],
  "mappings": "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",
  "names": []
}
