{
  "version": 3,
  "sources": ["../../../../../src/httpsnippet-lite/targets/swift/nsurlsession/client.ts"],
  "sourcesContent": ["/**\n * @description\n * HTTP code snippet generator for Swift using NSURLSession.\n *\n * @author\n * @thibaultCha\n *\n * for any questions or issues regarding the generated code snippet, please open an issue mentioning the author.\n */\n\nimport { CodeBuilder } from '@/httpsnippet-lite/helpers/code-builder'\nimport { literalDeclaration } from '@/httpsnippet-lite/targets/swift/helpers'\nimport type { Client } from '@/httpsnippet-lite/targets/target'\n\nexport const nsurlsession: Client = {\n  info: {\n    key: 'nsurlsession',\n    title: 'NSURLSession',\n    link: 'https://developer.apple.com/library/mac/documentation/Foundation/Reference/NSURLSession_class/index.html',\n    description: \"Foundation's NSURLSession request\",\n  },\n  convert: ({ allHeaders, postData, fullUrl, method }, options) => {\n    let _a\n    const opts = {\n      indent: '  ',\n      pretty: true,\n      timeout: '10',\n      ...options,\n    }\n    const { push, blank, join } = new CodeBuilder({ indent: opts.indent })\n    // Markers for headers to be created as litteral objects and later be set on the NSURLRequest if exist\n    const req = {\n      hasHeaders: false,\n      hasBody: false,\n    }\n    // We just want to make sure people understand that is the only dependency\n    push('import Foundation')\n    if (Object.keys(allHeaders).length) {\n      req.hasHeaders = true\n      blank()\n      push(literalDeclaration('headers', allHeaders, opts))\n    }\n    if (postData && (postData.text || postData.jsonObj || postData.params)) {\n      req.hasBody = true\n      switch (postData.mimeType) {\n        case 'application/x-www-form-urlencoded':\n          // By appending parameters one by one in the resulting snippet,\n          // we make it easier for the user to edit it according to his or her needs after pasting.\n          // The user can just add/remove lines adding/removing body parameters.\n          blank()\n          if ((_a = postData.params) === null || _a === void 0 ? void 0 : _a.length) {\n            const [head, ...tail] = postData.params!\n            push(\n              `let postData = NSMutableData(data: \"${head!.name}=${head!.value}\".data(using: String.Encoding.utf8)!)`,\n            )\n            tail.forEach(({ name, value }) => {\n              push(`postData.append(\"&${name}=${value}\".data(using: String.Encoding.utf8)!)`)\n            })\n          } else {\n            req.hasBody = false\n          }\n          break\n        case 'application/json':\n          if (postData.jsonObj) {\n            push(`${literalDeclaration('parameters', postData.jsonObj, opts)} as [String : Any]`)\n            blank()\n            push('let postData = JSONSerialization.data(withJSONObject: parameters, options: [])')\n          }\n          break\n        case 'multipart/form-data':\n          /**\n           * By appending multipart parameters one by one in the resulting snippet,\n           * we make it easier for the user to edit it according to his or her needs after pasting.\n           * The user can just edit the parameters NSDictionary or put this part of a snippet in a multipart builder method.\n           */\n          push(literalDeclaration('parameters', postData.params, opts))\n          blank()\n          push(`let boundary = \"${postData.boundary}\"`)\n          blank()\n          push('var body = \"\"')\n          push('var error: NSError? = nil')\n          push('for param in parameters {')\n          push('let paramName = param[\"name\"]!', 1)\n          push('body += \"--\\\\(boundary)\\\\r\\\\n\"', 1)\n          push('body += \"Content-Disposition:form-data; name=\\\\\"\\\\(paramName)\\\\\"\"', 1)\n          push('if let filename = param[\"fileName\"] {', 1)\n          push('let contentType = param[\"content-type\"]!', 2)\n          push('let fileContent = String(contentsOfFile: filename, encoding: String.Encoding.utf8)', 2)\n          push('if (error != nil) {', 2)\n          push('print(error as Any)', 3)\n          push('}', 2)\n          push('body += \"; filename=\\\\\"\\\\(filename)\\\\\"\\\\r\\\\n\"', 2)\n          push('body += \"Content-Type: \\\\(contentType)\\\\r\\\\n\\\\r\\\\n\"', 2)\n          push('body += fileContent', 2)\n          push('} else if let paramValue = param[\"value\"] {', 1)\n          push('body += \"\\\\r\\\\n\\\\r\\\\n\\\\(paramValue)\"', 2)\n          push('}', 1)\n          push('}')\n          break\n        default:\n          blank()\n          push(`let postData = NSData(data: \"${postData.text}\".data(using: String.Encoding.utf8)!)`)\n      }\n    }\n    blank()\n    // NSURLRequestUseProtocolCachePolicy is the default policy, let's just always set it to avoid confusion.\n    push(`let request = NSMutableURLRequest(url: NSURL(string: \"${fullUrl}\")! as URL,`)\n    push('                                        cachePolicy: .useProtocolCachePolicy,')\n    push(`                                    timeoutInterval: ${Number.parseInt(opts.timeout, 10).toFixed(1)})`)\n    push(`request.httpMethod = \"${method}\"`)\n    if (req.hasHeaders) {\n      push('request.allHTTPHeaderFields = headers')\n    }\n    if (req.hasBody) {\n      push('request.httpBody = postData as Data')\n    }\n    blank()\n    // Retrieving the shared session will be less verbose than creating a new one.\n    push('let session = URLSession.shared')\n    push(\n      'let dataTask = session.dataTask(with: request as URLRequest, completionHandler: { (data, response, error) -> Void in',\n    )\n    push('if (error != nil) {', 1)\n    push('print(error as Any)', 2)\n    push('} else {', 1) // Casting the NSURLResponse to NSHTTPURLResponse so the user can see the status     .\n    push('let httpResponse = response as? HTTPURLResponse', 2)\n    push('print(httpResponse)', 2)\n    push('}', 1)\n    push('})')\n    blank()\n    push('dataTask.resume()')\n    return join()\n  },\n}\n"],
  "mappings": "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",
  "names": []
}
