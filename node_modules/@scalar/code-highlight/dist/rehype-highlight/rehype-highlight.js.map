{
  "version": 3,
  "sources": ["../../src/rehype-highlight/rehype-highlight.ts"],
  "sourcesContent": ["import type { Element, ElementContent, Root } from 'hast'\nimport { toText } from 'hast-util-to-text'\nimport { type LanguageFn, createLowlight } from 'lowlight'\nimport { visit } from 'unist-util-visit'\nimport type { VFile } from 'vfile'\n\nimport { lowlightLanguageMappings } from '../constants'\n\ntype HighlightOptions = {\n  /** Optional existing lowlight instance to use */\n  lowlight?: ReturnType<typeof createLowlight> | undefined\n  /** Register more aliases (optional); passed to `lowlight.registerAlias` */\n  aliases?: Readonly<Record<string, ReadonlyArray<string> | string>> | null | undefined\n  /** Register languages (default: `common`) passed to `lowlight.register` */\n  languages?: Readonly<Record<string, LanguageFn>> | null | undefined\n  /** List of language names to not highlight (optional). Note: you can also add `no-highlight` classes. */\n  plainText?: ReadonlyArray<string> | null | undefined\n  /** Class prefix (default: `'hljs-'`) */\n  prefix?: string | null | undefined\n  /** Names of languages to check when detecting (default: all registered languages) */\n  subset?: ReadonlyArray<string> | null | undefined\n  /** Option to autodetect languages */\n  detect?: boolean\n}\n\nconst emptyOptions: HighlightOptions = {}\n\n/**\n * Lowlight syntax highlighting plugin for rehype pipelines\n *\n * Derived from: @url https://github.com/rehypejs/rehype-highlight/blob/main/lib/index.js\n */\nexport function rehypeHighlight(options?: Readonly<HighlightOptions> | null | undefined) {\n  const settings = options || emptyOptions\n  const aliases = settings.aliases\n  const detect = options?.detect ?? false\n  const languages = settings.languages\n  const plainText = settings.plainText\n  const prefix = settings.prefix\n  const subset = settings.subset\n  let name = 'hljs'\n\n  // Create a lowlight instance if not provided\n  const lowlight = options?.lowlight ?? createLowlight(languages)\n\n  if (aliases) {\n    lowlight.registerAlias(aliases)\n  }\n\n  if (prefix) {\n    const pos = prefix.indexOf('-')\n    name = pos > -1 ? prefix.slice(0, pos) : prefix\n  }\n\n  /** Transform.*/\n  return (tree: Root, file: VFile) => {\n    visit(tree, 'element', (node, _, parent) => {\n      if (node.tagName !== 'code' || !parent || parent.type !== 'element' || parent.tagName !== 'pre') {\n        return\n      }\n\n      const lang = language(node)\n\n      if (lang === 'no-highlight' || (!lang && !detect) || (lang && plainText?.includes(lang))) {\n        return\n      }\n\n      if (!Array.isArray(node.properties.className)) {\n        node.properties.className = []\n      }\n\n      if (!node.properties.className.includes(name)) {\n        node.properties.className.unshift(name)\n      }\n\n      let result: Root | undefined\n\n      try {\n        result = lang\n          ? lowlight.highlight(lang, toText(parent), { prefix })\n          : lowlight.highlightAuto(toText(parent), { prefix, subset })\n      } catch (error) {\n        const cause = error as Error\n\n        if (lang && /Unknown language/.test(cause.message)) {\n          file.message(`Cannot highlight as \\`${lang}\\`, it's not registered`, {\n            ancestors: [parent, node],\n            cause,\n            place: node.position,\n            ruleId: 'missing-language',\n            source: 'rehype-highlight',\n          })\n\n          /* c8 ignore next 5 -- throw arbitrary hljs errors */\n          return\n        }\n\n        throw cause\n      }\n\n      if (!lang && result.data?.language) {\n        node.properties.className.push('language-' + result.data.language)\n      }\n\n      if (result.children.length > 0) {\n        node.children = result.children as Array<ElementContent>\n      }\n    })\n  }\n}\n\n/** Get the programming language of `node` or an empty string */\nfunction language(node: Element) {\n  const list = node.properties.className\n\n  if (!Array.isArray(list)) {\n    return ''\n  }\n\n  const name: string = list.reduce<string>((result, _item) => {\n    if (result) {\n      return result\n    }\n    const item = String(_item)\n\n    if (item === 'no-highlight' || item === 'nohighlight') {\n      return 'no-highlight'\n    }\n    if (item.slice(0, 5) === 'lang-') {\n      return item.slice(5)\n    }\n    if (item.slice(0, 9) === 'language-') {\n      return item.slice(9)\n    }\n\n    return result\n  }, '')\n\n  return lowlightLanguageMappings[name || ''] || name\n}\n"],
  "mappings": "AACA,SAAS,cAAc;AACvB,SAA0B,sBAAsB;AAChD,SAAS,aAAa;AAGtB,SAAS,gCAAgC;AAmBzC,MAAM,eAAiC,CAAC;AAOjC,SAAS,gBAAgB,SAAyD;AACvF,QAAM,WAAW,WAAW;AAC5B,QAAM,UAAU,SAAS;AACzB,QAAM,SAAS,SAAS,UAAU;AAClC,QAAM,YAAY,SAAS;AAC3B,QAAM,YAAY,SAAS;AAC3B,QAAM,SAAS,SAAS;AACxB,QAAM,SAAS,SAAS;AACxB,MAAI,OAAO;AAGX,QAAM,WAAW,SAAS,YAAY,eAAe,SAAS;AAE9D,MAAI,SAAS;AACX,aAAS,cAAc,OAAO;AAAA,EAChC;AAEA,MAAI,QAAQ;AACV,UAAM,MAAM,OAAO,QAAQ,GAAG;AAC9B,WAAO,MAAM,KAAK,OAAO,MAAM,GAAG,GAAG,IAAI;AAAA,EAC3C;AAGA,SAAO,CAAC,MAAY,SAAgB;AAClC,UAAM,MAAM,WAAW,CAAC,MAAM,GAAG,WAAW;AAC1C,UAAI,KAAK,YAAY,UAAU,CAAC,UAAU,OAAO,SAAS,aAAa,OAAO,YAAY,OAAO;AAC/F;AAAA,MACF;AAEA,YAAM,OAAO,SAAS,IAAI;AAE1B,UAAI,SAAS,kBAAmB,CAAC,QAAQ,CAAC,UAAY,QAAQ,WAAW,SAAS,IAAI,GAAI;AACxF;AAAA,MACF;AAEA,UAAI,CAAC,MAAM,QAAQ,KAAK,WAAW,SAAS,GAAG;AAC7C,aAAK,WAAW,YAAY,CAAC;AAAA,MAC/B;AAEA,UAAI,CAAC,KAAK,WAAW,UAAU,SAAS,IAAI,GAAG;AAC7C,aAAK,WAAW,UAAU,QAAQ,IAAI;AAAA,MACxC;AAEA,UAAI;AAEJ,UAAI;AACF,iBAAS,OACL,SAAS,UAAU,MAAM,OAAO,MAAM,GAAG,EAAE,OAAO,CAAC,IACnD,SAAS,cAAc,OAAO,MAAM,GAAG,EAAE,QAAQ,OAAO,CAAC;AAAA,MAC/D,SAAS,OAAO;AACd,cAAM,QAAQ;AAEd,YAAI,QAAQ,mBAAmB,KAAK,MAAM,OAAO,GAAG;AAClD,eAAK,QAAQ,yBAAyB,IAAI,2BAA2B;AAAA,YACnE,WAAW,CAAC,QAAQ,IAAI;AAAA,YACxB;AAAA,YACA,OAAO,KAAK;AAAA,YACZ,QAAQ;AAAA,YACR,QAAQ;AAAA,UACV,CAAC;AAGD;AAAA,QACF;AAEA,cAAM;AAAA,MACR;AAEA,UAAI,CAAC,QAAQ,OAAO,MAAM,UAAU;AAClC,aAAK,WAAW,UAAU,KAAK,cAAc,OAAO,KAAK,QAAQ;AAAA,MACnE;AAEA,UAAI,OAAO,SAAS,SAAS,GAAG;AAC9B,aAAK,WAAW,OAAO;AAAA,MACzB;AAAA,IACF,CAAC;AAAA,EACH;AACF;AAGA,SAAS,SAAS,MAAe;AAC/B,QAAM,OAAO,KAAK,WAAW;AAE7B,MAAI,CAAC,MAAM,QAAQ,IAAI,GAAG;AACxB,WAAO;AAAA,EACT;AAEA,QAAM,OAAe,KAAK,OAAe,CAAC,QAAQ,UAAU;AAC1D,QAAI,QAAQ;AACV,aAAO;AAAA,IACT;AACA,UAAM,OAAO,OAAO,KAAK;AAEzB,QAAI,SAAS,kBAAkB,SAAS,eAAe;AACrD,aAAO;AAAA,IACT;AACA,QAAI,KAAK,MAAM,GAAG,CAAC,MAAM,SAAS;AAChC,aAAO,KAAK,MAAM,CAAC;AAAA,IACrB;AACA,QAAI,KAAK,MAAM,GAAG,CAAC,MAAM,aAAa;AACpC,aAAO,KAAK,MAAM,CAAC;AAAA,IACrB;AAEA,WAAO;AAAA,EACT,GAAG,EAAE;AAEL,SAAO,yBAAyB,QAAQ,EAAE,KAAK;AACjD;",
  "names": []
}
